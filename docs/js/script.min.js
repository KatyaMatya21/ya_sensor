var buttonMenu=document.querySelector(".js-menu-button"),menu=document.querySelector(".header-menu");buttonMenu.addEventListener("click",function(){menu.classList.toggle("header-menu--opened")});var data,grid=document.querySelector(".grid"),template=document.querySelector("#moduleTemplate"),moduleTemplate=template.content.querySelector(".module"),modulePicture=template.content.querySelector(".module__picture"),moduleDetails=template.content.querySelector(".module__cam-details"),xhr=new XMLHttpRequest;xhr.open("GET","events.json",!1),xhr.send(),200!=xhr.status?alert(xhr.status+": "+xhr.statusText):data=JSON.parse(xhr.responseText);var events=data.events;function createElementFromHTML(e){var t=document.createElement("div");return t.innerHTML=e.trim(),t.firstChild}function parseTemplate(e,t){var r=e.outerHTML;return Object.keys(t).forEach(function(e){null===t[e]&&(t[e]=""),r=r.replace("{{ "+e+" }}",t[e])}),createElementFromHTML(r)}for(var i=0;i<events.length;i++){var module=moduleTemplate.cloneNode(!0);if(module=parseTemplate(moduleTemplate,events[i]),""===events[i].description&&module.querySelector(".module__message").classList.add("module__message--disabled"),"data"in events[i]&&"cam"===events[i].icon){var picture=modulePicture.cloneNode(!0),details=moduleDetails.cloneNode(!0);module.querySelector(".module__message").appendChild(picture),module.querySelector(".module__message").appendChild(details)}grid.appendChild(module)}var imageContainer=document.querySelector(".module__picture"),image=document.querySelector(".module__image"),imageIndicator=document.querySelector(".module__indicator"),imageScale=document.querySelector(".module__scale strong"),imageBrightness=document.querySelector(".module__light strong"),imageWindow=imageContainer.offsetWidth,imageWidth=image.offsetWidth,imageIndicatorWidth=imageIndicator.offsetWidth,pointerArray=[],distancePrev=0,currentScale=1,currentBrightness=100,prevAngleChange=0;image.style.left="0px",imageIndicator.style.left="0px",image.style.transform="scale("+currentScale+")",imageScale.innerHTML=100*currentScale+"%",imageBrightness.innerHTML=currentBrightness+"%";var moveToStartPosition=function(){imageWindow=imageContainer.offsetWidth,imageWidth=image.offsetWidth,imageIndicatorWidth=imageIndicator.offsetWidth,image.style.left="0px",imageIndicator.style.left="0px",image.style.transform="scale(1)",imageBrightness.innerHTML="100%",imageScale.innerHTML="100%"},getDistance=function(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},getAngle=function(e,t){return Math.atan2(e.y-t.y,e.x-t.x)},onMove=function(e){var t=pointerArray[e].prevPosition.x,r=event.x,n=r-t,i=1*image.style.left.replace("px",""),a=1*imageIndicator.style.left.replace("px",""),o=(imageWindow-imageIndicatorWidth)/(imageWidth-imageWindow);0<n?i+=Math.abs(n):i-=Math.abs(n),0<n?a-=Math.abs(n)*o:a+=Math.abs(n)*o,0<i&&(a=i=0),i<imageWindow-imageWidth&&(i=imageWindow-imageWidth,a=imageWindow-imageIndicatorWidth),image.style.left=i+"px",pointerArray[e].prevPosition.x=r,imageIndicator.style.left=a+"px"},onPinch=function(){var e=getDistance(pointerArray[0].currentPosition,pointerArray[1].currentPosition),t=getDistance(pointerArray[0].startPosition,pointerArray[1].startPosition);if(!(Math.abs(e-t)<30)){if(distancePrev){distancePrev<e?currentScale+=.03:(currentScale-=.03)<=1&&(currentScale=1),image.style.transform="scale("+currentScale+")",imageScale.innerHTML=Math.ceil(100*currentScale)+"%"}distancePrev=e}},onRotate=function(){var e=getAngle(pointerArray[0].startPosition,pointerArray[1].startPosition),t=getAngle(pointerArray[0].currentPosition,pointerArray[1].currentPosition),r=180*(t-e)/Math.PI;if(prevAngleChange){if(Math.abs(e-t)<.5)return;r<0&&(r+=360),prevAngleChange<r?currentBrightness+=1:currentBrightness-=1,100<currentBrightness&&(currentBrightness=100),currentBrightness<0&&(currentBrightness=0),image.style.filter="brightness("+currentBrightness+"%)",imageBrightness.innerHTML=Math.ceil(currentBrightness)+"%"}prevAngleChange=r};window.addEventListener("resize",function(){moveToStartPosition()}),imageContainer.addEventListener("pointerdown",function(e){imageContainer.setPointerCapture(e.pointerId),pointerArray.push({id:e.pointerId,startPosition:{x:e.x,y:e.y},prevPosition:{x:e.x,y:e.y},currentPosition:{x:e.x,y:e.y}})}),imageContainer.addEventListener("pointermove",function(e){if(0!==pointerArray.length){for(var t=null,r=0;r<pointerArray.length;r++)if(pointerArray[r].id===e.pointerId){t=r;break}pointerArray[t].currentPosition.x=e.x,pointerArray[t].currentPosition.y=e.y,1<pointerArray.length?(onPinch(),onRotate()):onMove(t)}}),imageContainer.addEventListener("pointerup",function(e){for(var t=null,r=0;r<pointerArray.length;r++)pointerArray[r].id===e.pointerId&&(t=r);pointerArray.splice(pointerArray[t],1)}),imageContainer.addEventListener("pointercancel",moveToStartPosition);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJidXR0b25NZW51IiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwibWVudSIsImFkZEV2ZW50TGlzdGVuZXIiLCJjbGFzc0xpc3QiLCJ0b2dnbGUiLCJkYXRhIiwiZ3JpZCIsInRlbXBsYXRlIiwibW9kdWxlVGVtcGxhdGUiLCJjb250ZW50IiwibW9kdWxlUGljdHVyZSIsIm1vZHVsZURldGFpbHMiLCJ4aHIiLCJYTUxIdHRwUmVxdWVzdCIsIm9wZW4iLCJzZW5kIiwic3RhdHVzIiwiYWxlcnQiLCJzdGF0dXNUZXh0IiwiSlNPTiIsInBhcnNlIiwicmVzcG9uc2VUZXh0IiwiZXZlbnRzIiwiY3JlYXRlRWxlbWVudEZyb21IVE1MIiwiaHRtbFN0cmluZyIsImRpdiIsImNyZWF0ZUVsZW1lbnQiLCJpbm5lckhUTUwiLCJ0cmltIiwiZmlyc3RDaGlsZCIsInBhcnNlVGVtcGxhdGUiLCJ2YXJpYWJsZXMiLCJyZXN1bHQiLCJvdXRlckhUTUwiLCJPYmplY3QiLCJrZXlzIiwiZm9yRWFjaCIsImtleSIsInJlcGxhY2UiLCJpIiwibGVuZ3RoIiwibW9kdWxlIiwiY2xvbmVOb2RlIiwiZGVzY3JpcHRpb24iLCJhZGQiLCJpY29uIiwicGljdHVyZSIsImRldGFpbHMiLCJhcHBlbmRDaGlsZCIsImltYWdlQ29udGFpbmVyIiwiaW1hZ2UiLCJpbWFnZUluZGljYXRvciIsImltYWdlU2NhbGUiLCJpbWFnZUJyaWdodG5lc3MiLCJpbWFnZVdpbmRvdyIsIm9mZnNldFdpZHRoIiwiaW1hZ2VXaWR0aCIsImltYWdlSW5kaWNhdG9yV2lkdGgiLCJwb2ludGVyQXJyYXkiLCJkaXN0YW5jZVByZXYiLCJjdXJyZW50U2NhbGUiLCJjdXJyZW50QnJpZ2h0bmVzcyIsInByZXZBbmdsZUNoYW5nZSIsInN0eWxlIiwibGVmdCIsInRyYW5zZm9ybSIsIm1vdmVUb1N0YXJ0UG9zaXRpb24iLCJnZXREaXN0YW5jZSIsInAxIiwicDIiLCJNYXRoIiwic3FydCIsInBvdyIsIngiLCJ5IiwiZ2V0QW5nbGUiLCJhdGFuMiIsIm9uTW92ZSIsImluZGV4Iiwic3RhcnRYIiwicHJldlBvc2l0aW9uIiwiZXZlbnQiLCJkeCIsImxlZnRJbmRpY2F0b3IiLCJkbGVmdCIsImFicyIsIm9uUGluY2giLCJkaXN0YW5jZSIsImN1cnJlbnRQb3NpdGlvbiIsImRpc3RhbmNlU3RhcnQiLCJzdGFydFBvc2l0aW9uIiwiY2VpbCIsIm9uUm90YXRlIiwic3RhcnRBbmdsZSIsImN1cnJlbnRBbmdsZSIsImFuZ2xlQ2hhbmdlIiwiUEkiLCJmaWx0ZXIiLCJ3aW5kb3ciLCJzZXRQb2ludGVyQ2FwdHVyZSIsInBvaW50ZXJJZCIsInB1c2giLCJpZCIsInNwbGljZSJdLCJtYXBwaW5ncyI6IkFBQUEsSUFBSUEsV0FBYUMsU0FBU0MsY0FBYyxtQkFDcENDLEtBQU9GLFNBQVNDLGNBQWMsZ0JBRWxDRixXQUFXSSxpQkFBaUIsUUFBUyxXQUNuQ0QsS0FBS0UsVUFBVUMsT0FBTyx5QkFHeEIsSUFRSUMsS0FSQUMsS0FBT1AsU0FBU0MsY0FBYyxTQUU5Qk8sU0FBV1IsU0FBU0MsY0FBYyxtQkFFbENRLGVBQWlCRCxTQUFTRSxRQUFRVCxjQUFjLFdBQ2hEVSxjQUFnQkgsU0FBU0UsUUFBUVQsY0FBYyxvQkFDL0NXLGNBQWdCSixTQUFTRSxRQUFRVCxjQUFjLHdCQUkvQ1ksSUFBTSxJQUFJQyxlQUNkRCxJQUFJRSxLQUFLLE1BQU8sZUFBZSxHQUMvQkYsSUFBSUcsT0FDYyxLQUFkSCxJQUFJSSxPQUNOQyxNQUFPTCxJQUFJSSxPQUFTLEtBQU9KLElBQUlNLFlBRS9CYixLQUFPYyxLQUFLQyxNQUFNUixJQUFJUyxjQUd4QixJQUFJQyxPQUFTakIsS0FBS2lCLE9BRWxCLFNBQVNDLHNCQUFzQkMsR0FDN0IsSUFBSUMsRUFBTTFCLFNBQVMyQixjQUFjLE9BRWpDLE9BREFELEVBQUlFLFVBQVlILEVBQVdJLE9BQ3BCSCxFQUFJSSxXQUdiLFNBQVNDLGNBQWN2QixFQUFVd0IsR0FDL0IsSUFBSUMs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QWlCLFNBQVUsV0FDaENnRSx3QkFHRmpCLGVBQWUvQyxpQkFBaUIsY0FBZSxTQUFVK0UsR0FDdkRoQyxlQUFla0Qsa0JBQWtCbEIsRUFBTW1CLFdBRXZDMUMsYUFBYTJDLEtBQUssQ0FDaEJDLEdBQUlyQixFQUFNbUIsVUFDVlYsY0FBZSxDQUNiakIsRUFBR1EsRUFBTVIsRUFDVEMsRUFBR08sRUFBTVAsR0FFWE0sYUFBYyxDQUNaUCxFQUFHUSxFQUFNUixFQUNUQyxFQUFHTyxFQUFNUCxHQUVYYyxnQkFBaUIsQ0FDZmYsRUFBR1EsRUFBTVIsRUFDVEMsRUFBR08sRUFBTVAsT0FLZnpCLGVBQWUvQyxpQkFBaUIsY0FBZSxTQUFVK0UsR0FDdkQsR0FBNEIsSUFBeEJ2QixhQUFhbEIsT0FBakIsQ0FLQSxJQURBLElBQUlzQyxFQUFRLEtBQ0h2QyxFQUFJLEVBQUdBLEVBQUltQixhQUFhbEIsT0FBUUQsSUFDdkMsR0FBSW1CLGFBQWFuQixHQUFHK0QsS0FBT3JCLEVBQU1tQixVQUFXLENBQzFDdEIsRUFBUXZDLEVBQ1IsTUFJSm1CLGFBQWFvQixHQUFPVSxnQkFBZ0JmLEVBQUlRLEVBQU1SLEVBQzlDZixhQUFhb0IsR0FBT1UsZ0JBQWdCZCxFQUFJTyxFQUFNUCxFQUVwQixFQUF0QmhCLGFBQWFsQixRQUVmOEMsVUFFQU0sWUFJQWYsT0FBT0MsTUFLWDdCLGVBQWUvQyxpQkFBaUIsWUFBYSxTQUFVK0UsR0FHckQsSUFGQSxJQUFJSCxFQUFRLEtBRUh2QyxFQUFJLEVBQUdBLEVBQUltQixhQUFhbEIsT0FBUUQsSUFDbkNtQixhQUFhbkIsR0FBRytELEtBQU9yQixFQUFNbUIsWUFDL0J0QixFQUFRdkMsR0FJWm1CLGFBQWE2QyxPQUFPN0MsYUFBYW9CLEdBQVEsS0FHM0M3QixlQUFlL0MsaUJBQWlCLGdCQUFpQmdFIiwiZmlsZSI6InNjcmlwdC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgYnV0dG9uTWVudSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5qcy1tZW51LWJ1dHRvbicpO1xudmFyIG1lbnUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaGVhZGVyLW1lbnUnKTtcblxuYnV0dG9uTWVudS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgbWVudS5jbGFzc0xpc3QudG9nZ2xlKCdoZWFkZXItbWVudS0tb3BlbmVkJyk7XG59KTtcblxudmFyIGdyaWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZ3JpZCcpO1xuXG52YXIgdGVtcGxhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbW9kdWxlVGVtcGxhdGUnKTtcblxudmFyIG1vZHVsZVRlbXBsYXRlID0gdGVtcGxhdGUuY29udGVudC5xdWVyeVNlbGVjdG9yKCcubW9kdWxlJyk7XG52YXIgbW9kdWxlUGljdHVyZSA9IHRlbXBsYXRlLmNvbnRlbnQucXVlcnlTZWxlY3RvcignLm1vZHVsZV9fcGljdHVyZScpO1xudmFyIG1vZHVsZURldGFpbHMgPSB0ZW1wbGF0ZS5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2R1bGVfX2NhbS1kZXRhaWxzJyk7XG5cbnZhciBkYXRhO1xuXG52YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG54aHIub3BlbignR0VUJywgJ2V2ZW50cy5qc29uJywgZmFsc2UpO1xueGhyLnNlbmQoKTtcbmlmICh4aHIuc3RhdHVzICE9IDIwMCkge1xuICBhbGVydCggeGhyLnN0YXR1cyArICc6ICcgKyB4aHIuc3RhdHVzVGV4dCApO1xufSBlbHNlIHtcbiAgZGF0YSA9IEpTT04ucGFyc2UoeGhyLnJlc3BvbnNlVGV4dCk7XG59XG5cbnZhciBldmVudHMgPSBkYXRhLmV2ZW50cztcblxuZnVuY3Rpb24gY3JlYXRlRWxlbWVudEZyb21IVE1MKGh0bWxTdHJpbmcpIHtcbiAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICBkaXYuaW5uZXJIVE1MID0gaHRtbFN0cmluZy50cmltKCk7XG4gIHJldHVybiBkaXYuZmlyc3RDaGlsZDtcbn1cblxuZnVuY3Rpb24gcGFyc2VUZW1wbGF0ZSh0ZW1wbGF0ZSwgdmFyaWFibGVzKSB7XG4gIHZhciByZXN1bHQgPSB0ZW1wbGF0ZS5vdXRlckhUTUw7XG4gIE9iamVjdC5rZXlzKHZhcmlhYmxlcykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgaWYgKHZhcmlhYmxlc1trZXldID09PSBudWxsKSB7XG4gICAgICB2YXJpYWJsZXNba2V5XSA9ICcnO1xuICAgIH1cbiAgICByZXN1bHQgPSByZXN1bHQucmVwbGFjZSgne3sgJyArIGtleSArICcgfX0nLCB2YXJpYWJsZXNba2V5XSk7XG4gIH0pO1xuICByZXR1cm4gY3JlYXRlRWxlbWVudEZyb21IVE1MKHJlc3VsdCk7XG59XG5cbmZvciAodmFyIGkgPSAwOyBpIDwgZXZlbnRzLmxlbmd0aDsgaSsrKSB7XG5cbiAgdmFyIG1vZHVsZSA9IG1vZHVsZVRlbXBsYXRlLmNsb25lTm9kZSh0cnVlKTtcbiAgbW9kdWxlID0gcGFyc2VUZW1wbGF0ZShtb2R1bGVUZW1wbGF0ZSwgZXZlbnRzW2ldKTtcblxuICBpZiAoZXZlbnRzW2ldLmRlc2NyaXB0aW9uID09PSAnJykge1xuICAgIG1vZHVsZS5xdWVyeVNlbGVjdG9yKCcubW9kdWxlX19tZXNzYWdlJykuY2xhc3NMaXN0LmFkZCgnbW9kdWxlX19tZXNzYWdlLS1kaXNhYmxlZCcpO1xuICB9XG5cbiAgaWYgKCdkYXRhJyBpbiBldmVudHNbaV0pIHtcblxuICAgIGlmIChldmVudHNbaV0uaWNvbiA9PT0gJ2NhbScpIHtcbiAgICAgIHZhciBwaWN0dXJlID0gbW9kdWxlUGljdHVyZS5jbG9uZU5vZGUodHJ1ZSk7XG4gICAgICB2YXIgZGV0YWlscyA9IG1vZHVsZURldGFpbHMuY2xvbmVOb2RlKHRydWUpO1xuICAgICAgbW9kdWxlLnF1ZXJ5U2VsZWN0b3IoJy5tb2R1bGVfX21lc3NhZ2UnKS5hcHBlbmRDaGlsZChwaWN0dXJlKTtcbiAgICAgIG1vZHVsZS5xdWVyeVNlbGVjdG9yKCcubW9kdWxlX19tZXNzYWdlJykuYXBwZW5kQ2hpbGQoZGV0YWlscyk7XG4gICAgfVxuXG4gIH1cblxuICBncmlkLmFwcGVuZENoaWxkKG1vZHVsZSk7XG59XG5cbnZhciBpbWFnZUNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2R1bGVfX3BpY3R1cmUnKTtcbnZhciBpbWFnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2R1bGVfX2ltYWdlJyk7XG52YXIgaW1hZ2VJbmRpY2F0b3IgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kdWxlX19pbmRpY2F0b3InKTtcbnZhciBpbWFnZVNjYWxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZHVsZV9fc2NhbGUgc3Ryb25nJyk7XG52YXIgaW1hZ2VCcmlnaHRuZXNzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZHVsZV9fbGlnaHQgc3Ryb25nJyk7XG5cbnZhciBpbWFnZVdpbmRvdyA9IGltYWdlQ29udGFpbmVyLm9mZnNldFdpZHRoO1xudmFyIGltYWdlV2lkdGggPSBpbWFnZS5vZmZzZXRXaWR0aDtcbnZhciBpbWFnZUluZGljYXRvcldpZHRoID0gaW1hZ2VJbmRpY2F0b3Iub2Zmc2V0V2lkdGg7XG5cbnZhciBwb2ludGVyQXJyYXkgPSBbXTtcbnZhciBkaXN0YW5jZVByZXYgPSAwO1xudmFyIGN1cnJlbnRTY2FsZSA9IDE7XG52YXIgY3VycmVudEJyaWdodG5lc3MgPSAxMDA7XG52YXIgcHJldkFuZ2xlQ2hhbmdlID0gMDtcblxuaW1hZ2Uuc3R5bGUubGVmdCA9ICcwcHgnO1xuaW1hZ2VJbmRpY2F0b3Iuc3R5bGUubGVmdCA9ICcwcHgnO1xuXG5pbWFnZS5zdHlsZS50cmFuc2Zvcm0gPSBcInNjYWxlKFwiICsgY3VycmVudFNjYWxlICsgXCIpXCI7XG5cbmltYWdlU2NhbGUuaW5uZXJIVE1MID0gY3VycmVudFNjYWxlICogMTAwICsgJyUnO1xuaW1hZ2VCcmlnaHRuZXNzLmlubmVySFRNTCA9IGN1cnJlbnRCcmlnaHRuZXNzICsgJyUnO1xuXG52YXIgbW92ZVRvU3RhcnRQb3NpdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgaW1hZ2VXaW5kb3cgPSBpbWFnZUNvbnRhaW5lci5vZmZzZXRXaWR0aDtcbiAgaW1hZ2VXaWR0aCA9IGltYWdlLm9mZnNldFdpZHRoO1xuICBpbWFnZUluZGljYXRvcldpZHRoID0gaW1hZ2VJbmRpY2F0b3Iub2Zmc2V0V2lkdGg7XG5cbiAgaW1hZ2Uuc3R5bGUubGVmdCA9ICcwcHgnO1xuICBpbWFnZUluZGljYXRvci5zdHlsZS5sZWZ0ID0gJzBweCc7XG5cbiAgaW1hZ2Uuc3R5bGUudHJhbnNmb3JtID0gXCJzY2FsZShcIiArIDEgKyBcIilcIjtcblxuICBpbWFnZUJyaWdodG5lc3MuaW5uZXJIVE1MID0gJzEwMCUnO1xuICBpbWFnZVNjYWxlLmlubmVySFRNTCA9ICcxMDAlJztcbn07XG5cbnZhciBnZXREaXN0YW5jZSA9IGZ1bmN0aW9uIChwMSwgcDIpIHtcbiAgcmV0dXJuIE1hdGguc3FydChNYXRoLnBvdygocDIueCAtIHAxLngpLCAyKSArIE1hdGgucG93KChwMi55IC0gcDEueSksIDIpKTtcbn07XG5cbnZhciBnZXRBbmdsZSA9IGZ1bmN0aW9uIChwMSwgcDIpIHtcbiAgcmV0dXJuIE1hdGguYXRhbjIocDEueSAtIHAyLnksIHAxLnggLSBwMi54KTtcbn07XG5cbnZhciBvbk1vdmUgPSBmdW5jdGlvbiAoaW5kZXgpIHtcbiAgdmFyIHN0YXJ0WCA9IHBvaW50ZXJBcnJheVtpbmRleF0ucHJldlBvc2l0aW9uLng7XG4gIHZhciB4ID0gZXZlbnQueDtcbiAgdmFyIGR4ID0geCAtIHN0YXJ0WDtcblxuICB2YXIgbGVmdCA9IGltYWdlLnN0eWxlLmxlZnQucmVwbGFjZSgncHgnLCAnJykgKiAxO1xuICB2YXIgbGVmdEluZGljYXRvciA9IGltYWdlSW5kaWNhdG9yLnN0eWxlLmxlZnQucmVwbGFjZSgncHgnLCAnJykgKiAxO1xuXG4gIHZhciBkbGVmdCA9IChpbWFnZVdpbmRvdyAtIGltYWdlSW5kaWNhdG9yV2lkdGgpIC8gKGltYWdlV2lkdGggLSBpbWFnZVdpbmRvdyk7XG5cbiAgZHggPiAwID8gbGVmdCArPSBNYXRoLmFicyhkeCkgOiBsZWZ0IC09IE1hdGguYWJzKGR4KTtcbiAgZHggPiAwID8gbGVmdEluZGljYXRvciAtPSBNYXRoLmFicyhkeCkgKiBkbGVmdCA6IGxlZnRJbmRpY2F0b3IgKz0gTWF0aC5hYnMoZHgpICogZGxlZnQ7XG5cbiAgaWYgKGxlZnQgPiAwKSB7XG4gICAgbGVmdCA9IDA7XG4gICAgbGVmdEluZGljYXRvciA9IDA7XG4gIH1cblxuICBpZiAobGVmdCA8IGltYWdlV2luZG93IC0gaW1hZ2VXaWR0aCkge1xuICAgIGxlZnQgPSBpbWFnZVdpbmRvdyAtIGltYWdlV2lkdGg7XG4gICAgbGVmdEluZGljYXRvciA9IGltYWdlV2luZG93IC0gaW1hZ2VJbmRpY2F0b3JXaWR0aDtcbiAgfVxuXG4gIGltYWdlLnN0eWxlLmxlZnQgPSBsZWZ0ICsgJ3B4JztcbiAgcG9pbnRlckFycmF5W2luZGV4XS5wcmV2UG9zaXRpb24ueCA9IHg7XG5cbiAgaW1hZ2VJbmRpY2F0b3Iuc3R5bGUubGVmdCA9IGxlZnRJbmRpY2F0b3IgKyAncHgnO1xufTtcblxudmFyIG9uUGluY2ggPSBmdW5jdGlvbiAoKSB7XG5cbiAgdmFyIHBpbmNoVHJlc2hvbGQgPSAzMDtcblxuICB2YXIgZGlzdGFuY2UgPSBnZXREaXN0YW5jZShwb2ludGVyQXJyYXlbMF0uY3VycmVudFBvc2l0aW9uLCBwb2ludGVyQXJyYXlbMV0uY3VycmVudFBvc2l0aW9uKTtcbiAgdmFyIGRpc3RhbmNlU3RhcnQgPSBnZXREaXN0YW5jZShwb2ludGVyQXJyYXlbMF0uc3RhcnRQb3NpdGlvbiwgcG9pbnRlckFycmF5WzFdLnN0YXJ0UG9zaXRpb24pO1xuXG4gIGlmIChNYXRoLmFicyhkaXN0YW5jZSAtIGRpc3RhbmNlU3RhcnQpIDwgcGluY2hUcmVzaG9sZCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmIChkaXN0YW5jZVByZXYpIHtcbiAgICB2YXIgc2NhbGUgPSAwLjAzO1xuXG4gICAgaWYgKGRpc3RhbmNlID4gZGlzdGFuY2VQcmV2KSB7XG4gICAgICBjdXJyZW50U2NhbGUgKz0gc2NhbGU7XG4gICAgfSBlbHNlIHtcbiAgICAgIGN1cnJlbnRTY2FsZSAtPSBzY2FsZTtcbiAgICAgIGlmIChjdXJyZW50U2NhbGUgPD0gMSkge1xuICAgICAgICBjdXJyZW50U2NhbGUgPSAxO1xuICAgICAgfVxuICAgIH1cblxuICAgIGltYWdlLnN0eWxlLnRyYW5zZm9ybSA9IFwic2NhbGUoXCIgKyBjdXJyZW50U2NhbGUgKyBcIilcIjtcbiAgICBpbWFnZVNjYWxlLmlubmVySFRNTCA9IE1hdGguY2VpbChjdXJyZW50U2NhbGUgKiAxMDApICsgJyUnO1xuICB9XG5cbiAgZGlzdGFuY2VQcmV2ID0gZGlzdGFuY2U7XG59O1xuXG52YXIgb25Sb3RhdGUgPSBmdW5jdGlvbiAoKSB7XG5cbiAgdmFyIHJvdGF0ZVRyZXNob2xkID0gMC41O1xuXG4gIHZhciBzdGFydEFuZ2xlID0gZ2V0QW5nbGUocG9pbnRlckFycmF5WzBdLnN0YXJ0UG9zaXRpb24sIHBvaW50ZXJBcnJheVsxXS5zdGFydFBvc2l0aW9uKTtcbiAgdmFyIGN1cnJlbnRBbmdsZSA9IGdldEFuZ2xlKHBvaW50ZXJBcnJheVswXS5jdXJyZW50UG9zaXRpb24sIHBvaW50ZXJBcnJheVsxXS5jdXJyZW50UG9zaXRpb24pO1xuICB2YXIgYW5nbGVDaGFuZ2UgPSAoY3VycmVudEFuZ2xlIC0gc3RhcnRBbmdsZSkgKiAxODAgLyBNYXRoLlBJO1xuXG4gIGlmIChwcmV2QW5nbGVDaGFuZ2UpIHtcbiAgICAvL2NvbnNvbGUubG9nKCBNYXRoLmFicyhzdGFydEFuZ2xlLWN1cnJlbnRBbmdsZSkgKTtcbiAgICBpZiAoTWF0aC5hYnMoc3RhcnRBbmdsZSAtIGN1cnJlbnRBbmdsZSkgPCByb3RhdGVUcmVzaG9sZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChhbmdsZUNoYW5nZSA8IDApIHtcbiAgICAgIGFuZ2xlQ2hhbmdlICs9IDM2MDtcbiAgICB9XG5cbiAgICAvL3ZhciBicmlnaHRuZXNzID0gMTAwIC0gKGFuZ2xlQ2hhbmdlIC8gMzYwICogMTAwKTtcblxuICAgIGlmIChwcmV2QW5nbGVDaGFuZ2UgPCBhbmdsZUNoYW5nZSkge1xuICAgICAgY3VycmVudEJyaWdodG5lc3MgKz0gMTtcbiAgICB9IGVsc2Uge1xuICAgICAgY3VycmVudEJyaWdodG5lc3MgLT0gMTtcbiAgICB9XG5cbiAgICBpZiAoY3VycmVudEJyaWdodG5lc3MgPiAxMDApIHtcbiAgICAgIGN1cnJlbnRCcmlnaHRuZXNzID0gMTAwO1xuICAgIH1cblxuICAgIGlmIChjdXJyZW50QnJpZ2h0bmVzcyA8IDApIHtcbiAgICAgIGN1cnJlbnRCcmlnaHRuZXNzID0gMDtcbiAgICB9XG5cbiAgICBpbWFnZS5zdHlsZS5maWx0ZXIgPSAnYnJpZ2h0bmVzcygnICsgY3VycmVudEJyaWdodG5lc3MgKyAnJSknO1xuICAgIGltYWdlQnJpZ2h0bmVzcy5pbm5lckhUTUwgPSBNYXRoLmNlaWwoY3VycmVudEJyaWdodG5lc3MpICsgJyUnO1xuXG4gIH1cblxuICBwcmV2QW5nbGVDaGFuZ2UgPSBhbmdsZUNoYW5nZTtcblxufTtcblxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIGZ1bmN0aW9uICgpIHtcbiAgbW92ZVRvU3RhcnRQb3NpdGlvbigpO1xufSk7XG5cbmltYWdlQ29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ3BvaW50ZXJkb3duJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gIGltYWdlQ29udGFpbmVyLnNldFBvaW50ZXJDYXB0dXJlKGV2ZW50LnBvaW50ZXJJZCk7XG5cbiAgcG9pbnRlckFycmF5LnB1c2goe1xuICAgIGlkOiBldmVudC5wb2ludGVySWQsXG4gICAgc3RhcnRQb3NpdGlvbjoge1xuICAgICAgeDogZXZlbnQueCxcbiAgICAgIHk6IGV2ZW50LnlcbiAgICB9LFxuICAgIHByZXZQb3NpdGlvbjoge1xuICAgICAgeDogZXZlbnQueCxcbiAgICAgIHk6IGV2ZW50LnlcbiAgICB9LFxuICAgIGN1cnJlbnRQb3NpdGlvbjoge1xuICAgICAgeDogZXZlbnQueCxcbiAgICAgIHk6IGV2ZW50LnlcbiAgICB9XG4gIH0pO1xufSk7XG5cbmltYWdlQ29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ3BvaW50ZXJtb3ZlJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gIGlmIChwb2ludGVyQXJyYXkubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuXG4gIH1cblxuICB2YXIgaW5kZXggPSBudWxsO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHBvaW50ZXJBcnJheS5sZW5ndGg7IGkrKykge1xuICAgIGlmIChwb2ludGVyQXJyYXlbaV0uaWQgPT09IGV2ZW50LnBvaW50ZXJJZCkge1xuICAgICAgaW5kZXggPSBpO1xuICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG5cbiAgcG9pbnRlckFycmF5W2luZGV4XS5jdXJyZW50UG9zaXRpb24ueCA9IGV2ZW50Lng7XG4gIHBvaW50ZXJBcnJheVtpbmRleF0uY3VycmVudFBvc2l0aW9uLnkgPSBldmVudC55O1xuXG4gIGlmIChwb2ludGVyQXJyYXkubGVuZ3RoID4gMSkge1xuXG4gICAgb25QaW5jaCgpO1xuXG4gICAgb25Sb3RhdGUoKTtcblxuICB9IGVsc2Uge1xuXG4gICAgb25Nb3ZlKGluZGV4KTtcblxuICB9XG59KTtcblxuaW1hZ2VDb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcigncG9pbnRlcnVwJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gIHZhciBpbmRleCA9IG51bGw7XG5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBwb2ludGVyQXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICBpZiAocG9pbnRlckFycmF5W2ldLmlkID09PSBldmVudC5wb2ludGVySWQpIHtcbiAgICAgIGluZGV4ID0gaTtcbiAgICB9XG4gIH1cblxuICBwb2ludGVyQXJyYXkuc3BsaWNlKHBvaW50ZXJBcnJheVtpbmRleF0sIDEpO1xufSk7XG5cbmltYWdlQ29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ3BvaW50ZXJjYW5jZWwnLCBtb3ZlVG9TdGFydFBvc2l0aW9uKTtcblxuIl19
