var buttonMenu=document.querySelector(".js-menu-button"),menu=document.querySelector(".header-menu");buttonMenu.addEventListener("click",function(){menu.classList.toggle("header-menu--opened")});var data,grid=document.querySelector(".grid"),template=document.querySelector("#moduleTemplate"),moduleTemplate=template.content.querySelector(".module"),modulePicture=template.content.querySelector(".module__picture"),moduleDetails=template.content.querySelector(".module__cam-details"),xhr=new XMLHttpRequest;xhr.open("GET","events.json",!1),xhr.send(),200!=xhr.status?alert(xhr.status+": "+xhr.statusText):data=JSON.parse(xhr.responseText);var events=data.events;function createElementFromHTML(e){var t=document.createElement("div");return t.innerHTML=e.trim(),t.firstChild}function parseTemplate(e,t){var r=e.outerHTML;return Object.keys(t).forEach(function(e){null===t[e]&&(t[e]=""),r=r.replace("{{ "+e+" }}",t[e])}),createElementFromHTML(r)}for(var i=0;i<events.length;i++){var module=moduleTemplate.cloneNode(!0);if(module=parseTemplate(moduleTemplate,events[i]),""===events[i].description&&module.querySelector(".module__message").classList.add("module__message--disabled"),"data"in events[i]&&"cam"===events[i].icon){var picture=modulePicture.cloneNode(!0),details=moduleDetails.cloneNode(!0);module.querySelector(".module__message").appendChild(picture),module.querySelector(".module__message").appendChild(details)}grid.appendChild(module)}var imageContainer=document.querySelector(".module__picture"),image=document.querySelector(".module__image"),imageIndicator=document.querySelector(".module__indicator"),imageScale=document.querySelector(".module__scale strong"),imageBrightness=document.querySelector(".module__light strong"),imageWindow=imageContainer.offsetWidth,imageWidth=image.offsetWidth,imageIndicatorWidth=imageIndicator.offsetWidth,pointerArray=[],distancePrev=0,currentScale=1;image.style.left="0px",imageIndicator.style.left="0px",image.style.transform="scale("+currentScale+")",imageScale.innerHTML="100%",imageBrightness.innerHTML="100%";var moveToStartPosition=function(){imageWindow=imageContainer.offsetWidth,imageWidth=image.offsetWidth,imageIndicatorWidth=imageIndicator.offsetWidth,image.style.left="0px",imageIndicator.style.left="0px",image.style.transform="scale(1)",imageBrightness.innerHTML="100%",imageScale.innerHTML="100%"};window.addEventListener("resize",function(){moveToStartPosition()}),imageContainer.addEventListener("pointerdown",function(e){imageContainer.setPointerCapture(e.pointerId),pointerArray.push({id:e.pointerId,startPosition:{x:e.x,y:e.y},prevPosition:{x:e.x,y:e.y},currentPosition:{x:e.x,y:e.y}})}),imageContainer.addEventListener("pointermove",function(e){if(0!==pointerArray.length){for(var t=null,r=0;r<pointerArray.length;r++)if(pointerArray[r].id===e.pointerId){t=r;break}if(pointerArray[t].currentPosition.x=e.x,pointerArray[t].currentPosition.y=e.y,1<pointerArray.length){var i=pointerArray[0].startPosition.x,n=pointerArray[0].startPosition.y,a=pointerArray[1].startPosition.x,o=pointerArray[1].startPosition.y,l=pointerArray[0].currentPosition.x,s=pointerArray[0].currentPosition.y,d=pointerArray[1].currentPosition.x,m=pointerArray[1].currentPosition.y,c=Math.sqrt(Math.pow(d-l,2)+Math.pow(m-s,2));if(distancePrev){distancePrev<c?currentScale+=.02:(currentScale-=.02)<=1&&(currentScale=1),image.style.transform="scale("+currentScale+")",imageScale.innerHTML=Math.ceil(100*currentScale)+"%"}distancePrev=c;var u=Math.atan2(n-o,i-a),p=180*(Math.atan2(s-m,l-d)-u)/Math.PI;p<0&&(p+=360);var g=100-p/360*100;image.style.filter="brightness("+g+"%)",imageBrightness.innerHTML=Math.ceil(g)+"%"}else{var y=pointerArray[t].prevPosition.x,h=e.x,f=h-y,v=1*image.style.left.replace("px",""),x=1*imageIndicator.style.left.replace("px",""),S=(imageWindow-imageIndicatorWidth)/(imageWidth-imageWindow);0<f?v+=Math.abs(f):v-=Math.abs(f),0<f?x-=Math.abs(f)*S:x+=Math.abs(f)*S,0<v&&(x=v=0),v<imageWindow-imageWidth&&(v=imageWindow-imageWidth,x=imageWindow-imageIndicatorWidth),image.style.left=v+"px",pointerArray[t].prevPosition.x=h,imageIndicator.style.left=x+"px"}}}),imageContainer.addEventListener("pointerup",function(e){for(var t=null,r=0;r<pointerArray.length;r++)pointerArray[r].id===e.pointerId&&(t=r);pointerArray.splice(pointerArray[t],1)}),imageContainer.addEventListener("pointercancel",moveToStartPosition);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJidXR0b25NZW51IiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwibWVudSIsImFkZEV2ZW50TGlzdGVuZXIiLCJjbGFzc0xpc3QiLCJ0b2dnbGUiLCJkYXRhIiwiZ3JpZCIsInRlbXBsYXRlIiwibW9kdWxlVGVtcGxhdGUiLCJjb250ZW50IiwibW9kdWxlUGljdHVyZSIsIm1vZHVsZURldGFpbHMiLCJ4aHIiLCJYTUxIdHRwUmVxdWVzdCIsIm9wZW4iLCJzZW5kIiwic3RhdHVzIiwiYWxlcnQiLCJzdGF0dXNUZXh0IiwiSlNPTiIsInBhcnNlIiwicmVzcG9uc2VUZXh0IiwiZXZlbnRzIiwiY3JlYXRlRWxlbWVudEZyb21IVE1MIiwiaHRtbFN0cmluZyIsImRpdiIsImNyZWF0ZUVsZW1lbnQiLCJpbm5lckhUTUwiLCJ0cmltIiwiZmlyc3RDaGlsZCIsInBhcnNlVGVtcGxhdGUiLCJ2YXJpYWJsZXMiLCJyZXN1bHQiLCJvdXRlckhUTUwiLCJPYmplY3QiLCJrZXlzIiwiZm9yRWFjaCIsImtleSIsInJlcGxhY2UiLCJpIiwibGVuZ3RoIiwibW9kdWxlIiwiY2xvbmVOb2RlIiwiZGVzY3JpcHRpb24iLCJhZGQiLCJpY29uIiwicGljdHVyZSIsImRldGFpbHMiLCJhcHBlbmRDaGlsZCIsImltYWdlQ29udGFpbmVyIiwiaW1hZ2UiLCJpbWFnZUluZGljYXRvciIsImltYWdlU2NhbGUiLCJpbWFnZUJyaWdodG5lc3MiLCJpbWFnZVdpbmRvdyIsIm9mZnNldFdpZHRoIiwiaW1hZ2VXaWR0aCIsImltYWdlSW5kaWNhdG9yV2lkdGgiLCJwb2ludGVyQXJyYXkiLCJkaXN0YW5jZVByZXYiLCJjdXJyZW50U2NhbGUiLCJzdHlsZSIsImxlZnQiLCJ0cmFuc2Zvcm0iLCJtb3ZlVG9TdGFydFBvc2l0aW9uIiwid2luZG93IiwiZXZlbnQiLCJzZXRQb2ludGVyQ2FwdHVyZSIsInBvaW50ZXJJZCIsInB1c2giLCJpZCIsInN0YXJ0UG9zaXRpb24iLCJ4IiwieSIsInByZXZQb3NpdGlvbiIsImN1cnJlbnRQb3NpdGlvbiIsImluZGV4Iiwic3RhcnRQb3NpdGlvblgxIiwic3RhcnRQb3NpdGlvblkxIiwic3RhcnRQb3NpdGlvblgyIiwic3RhcnRQb3NpdGlvblkyIiwiY3VycmVudFBvc2l0aW9uWDEiLCJjdXJyZW50UG9zaXRpb25ZMSIsImN1cnJlbnRQb3NpdGlvblgyIiwiY3VycmVudFBvc2l0aW9uWTIiLCJkaXN0YW5jZSIsIk1hdGgiLCJzcXJ0IiwicG93IiwiY2VpbCIsInN0YXJ0QW5nbGUiLCJhdGFuMiIsImFuZ2xlQ2hhbmdlIiwiUEkiLCJicmlnaHRuZXNzIiwiZmlsdGVyIiwic3RhcnRYIiwiZHgiLCJsZWZ0SW5kaWNhdG9yIiwiZGxlZnQiLCJhYnMiLCJzcGxpY2UiXSwibWFwcGluZ3MiOiJBQUFBLElBQUlBLFdBQWFDLFNBQVNDLGNBQWMsbUJBQ3BDQyxLQUFPRixTQUFTQyxjQUFjLGdCQUVsQ0YsV0FBV0ksaUJBQWlCLFFBQVMsV0FDbkNELEtBQUtFLFVBQVVDLE9BQU8seUJBR3hCLElBUUlDLEtBUkFDLEtBQU9QLFNBQVNDLGNBQWMsU0FFOUJPLFNBQVdSLFNBQVNDLGNBQWMsbUJBRWxDUSxlQUFpQkQsU0FBU0UsUUFBUVQsY0FBYyxXQUNoRFUsY0FBZ0JILFNBQVNFLFFBQVFULGNBQWMsb0JBQy9DVyxjQUFnQkosU0FBU0UsUUFBUVQsY0FBYyx3QkFJL0NZLElBQU0sSUFBSUMsZUFDZEQsSUFBSUUsS0FBSyxNQUFPLGVBQWUsR0FDL0JGLElBQUlHLE9BQ2MsS0FBZEgsSUFBSUksT0FDTkMsTUFBT0wsSUFBSUksT0FBUyxLQUFPSixJQUFJTSxZQUUvQmIsS0FBT2MsS0FBS0MsTUFBTVIsSUFBSVMsY0FHeEIsSUFBSUMsT0FBU2pCLEtBQUtpQixPQUVsQixTQUFTQyxzQkFBc0JDLEdBQzdCLElBQUlDLEVBQU0xQixTQUFTMkIsY0FBYyxPQUVqQyxPQURBRCxFQUFJRSxVQUFZSCxFQUFXSSxPQUNwQkgsRUFBSUksV0FHYixT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M0QsRUFBTDJDLEVBQVNuQyxHQUFRd0IsS0FBS2MsSUFBSUgsR0FBTW5DLEdBQVF3QixLQUFLYyxJQUFJSCxHQUM1QyxFQUFMQSxFQUFTQyxHQUFpQlosS0FBS2MsSUFBSUgsR0FBTUUsRUFBUUQsR0FBaUJaLEtBQUtjLElBQUlILEdBQU1FLEVBRXRFLEVBQVByQyxJQUVGb0MsRUFEQXBDLEVBQU8sR0FJTEEsRUFBT1IsWUFBY0UsYUFDdkJNLEVBQU9SLFlBQWNFLFdBQ3JCMEMsRUFBZ0I1QyxZQUFjRyxxQkFHaENQLE1BQU1XLE1BQU1DLEtBQU9BLEVBQU8sS0FDMUJKLGFBQWFrQixHQUFPRixhQUFhRixFQUFJQSxFQUVyQ3JCLGVBQWVVLE1BQU1DLEtBQU9vQyxFQUFnQixTQUtoRGpELGVBQWUvQyxpQkFBaUIsWUFBYSxTQUFVZ0UsR0FHckQsSUFGQSxJQUFJVSxFQUFRLEtBRUhyQyxFQUFJLEVBQUdBLEVBQUltQixhQUFhbEIsT0FBUUQsSUFDbkNtQixhQUFhbkIsR0FBRytCLEtBQU9KLEVBQU1FLFlBQy9CUSxFQUFRckMsR0FJWm1CLGFBQWEyQyxPQUFPM0MsYUFBYWtCLEdBQVEsS0FJM0MzQixlQUFlL0MsaUJBQWlCLGdCQUFpQjhEIiwiZmlsZSI6InNjcmlwdC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgYnV0dG9uTWVudSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5qcy1tZW51LWJ1dHRvbicpO1xudmFyIG1lbnUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaGVhZGVyLW1lbnUnKTtcblxuYnV0dG9uTWVudS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgbWVudS5jbGFzc0xpc3QudG9nZ2xlKCdoZWFkZXItbWVudS0tb3BlbmVkJyk7XG59KTtcblxudmFyIGdyaWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZ3JpZCcpO1xuXG52YXIgdGVtcGxhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbW9kdWxlVGVtcGxhdGUnKTtcblxudmFyIG1vZHVsZVRlbXBsYXRlID0gdGVtcGxhdGUuY29udGVudC5xdWVyeVNlbGVjdG9yKCcubW9kdWxlJyk7XG52YXIgbW9kdWxlUGljdHVyZSA9IHRlbXBsYXRlLmNvbnRlbnQucXVlcnlTZWxlY3RvcignLm1vZHVsZV9fcGljdHVyZScpO1xudmFyIG1vZHVsZURldGFpbHMgPSB0ZW1wbGF0ZS5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2R1bGVfX2NhbS1kZXRhaWxzJyk7XG5cbnZhciBkYXRhO1xuXG52YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG54aHIub3BlbignR0VUJywgJ2V2ZW50cy5qc29uJywgZmFsc2UpO1xueGhyLnNlbmQoKTtcbmlmICh4aHIuc3RhdHVzICE9IDIwMCkge1xuICBhbGVydCggeGhyLnN0YXR1cyArICc6ICcgKyB4aHIuc3RhdHVzVGV4dCApO1xufSBlbHNlIHtcbiAgZGF0YSA9IEpTT04ucGFyc2UoeGhyLnJlc3BvbnNlVGV4dCk7XG59XG5cbnZhciBldmVudHMgPSBkYXRhLmV2ZW50cztcblxuZnVuY3Rpb24gY3JlYXRlRWxlbWVudEZyb21IVE1MKGh0bWxTdHJpbmcpIHtcbiAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICBkaXYuaW5uZXJIVE1MID0gaHRtbFN0cmluZy50cmltKCk7XG4gIHJldHVybiBkaXYuZmlyc3RDaGlsZDtcbn1cblxuZnVuY3Rpb24gcGFyc2VUZW1wbGF0ZSh0ZW1wbGF0ZSwgdmFyaWFibGVzKSB7XG4gIHZhciByZXN1bHQgPSB0ZW1wbGF0ZS5vdXRlckhUTUw7XG4gIE9iamVjdC5rZXlzKHZhcmlhYmxlcykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgaWYgKHZhcmlhYmxlc1trZXldID09PSBudWxsKSB7XG4gICAgICB2YXJpYWJsZXNba2V5XSA9ICcnO1xuICAgIH1cbiAgICByZXN1bHQgPSByZXN1bHQucmVwbGFjZSgne3sgJyArIGtleSArICcgfX0nLCB2YXJpYWJsZXNba2V5XSk7XG4gIH0pO1xuICByZXR1cm4gY3JlYXRlRWxlbWVudEZyb21IVE1MKHJlc3VsdCk7XG59XG5cbmZvciAodmFyIGkgPSAwOyBpIDwgZXZlbnRzLmxlbmd0aDsgaSsrKSB7XG5cbiAgdmFyIG1vZHVsZSA9IG1vZHVsZVRlbXBsYXRlLmNsb25lTm9kZSh0cnVlKTtcbiAgbW9kdWxlID0gcGFyc2VUZW1wbGF0ZShtb2R1bGVUZW1wbGF0ZSwgZXZlbnRzW2ldKTtcblxuICBpZiAoZXZlbnRzW2ldLmRlc2NyaXB0aW9uID09PSAnJykge1xuICAgIG1vZHVsZS5xdWVyeVNlbGVjdG9yKCcubW9kdWxlX19tZXNzYWdlJykuY2xhc3NMaXN0LmFkZCgnbW9kdWxlX19tZXNzYWdlLS1kaXNhYmxlZCcpO1xuICB9XG5cbiAgaWYgKCdkYXRhJyBpbiBldmVudHNbaV0pIHtcblxuICAgIGlmIChldmVudHNbaV0uaWNvbiA9PT0gJ2NhbScpIHtcbiAgICAgIHZhciBwaWN0dXJlID0gbW9kdWxlUGljdHVyZS5jbG9uZU5vZGUodHJ1ZSk7XG4gICAgICB2YXIgZGV0YWlscyA9IG1vZHVsZURldGFpbHMuY2xvbmVOb2RlKHRydWUpO1xuICAgICAgbW9kdWxlLnF1ZXJ5U2VsZWN0b3IoJy5tb2R1bGVfX21lc3NhZ2UnKS5hcHBlbmRDaGlsZChwaWN0dXJlKTtcbiAgICAgIG1vZHVsZS5xdWVyeVNlbGVjdG9yKCcubW9kdWxlX19tZXNzYWdlJykuYXBwZW5kQ2hpbGQoZGV0YWlscyk7XG4gICAgfVxuXG4gIH1cblxuICBncmlkLmFwcGVuZENoaWxkKG1vZHVsZSk7XG59XG5cbnZhciBpbWFnZUNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2R1bGVfX3BpY3R1cmUnKTtcbnZhciBpbWFnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2R1bGVfX2ltYWdlJyk7XG52YXIgaW1hZ2VJbmRpY2F0b3IgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kdWxlX19pbmRpY2F0b3InKTtcbnZhciBpbWFnZVNjYWxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZHVsZV9fc2NhbGUgc3Ryb25nJyk7XG52YXIgaW1hZ2VCcmlnaHRuZXNzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZHVsZV9fbGlnaHQgc3Ryb25nJyk7XG5cbnZhciBpbWFnZVdpbmRvdyA9IGltYWdlQ29udGFpbmVyLm9mZnNldFdpZHRoO1xudmFyIGltYWdlV2lkdGggPSBpbWFnZS5vZmZzZXRXaWR0aDtcbnZhciBpbWFnZUluZGljYXRvcldpZHRoID0gaW1hZ2VJbmRpY2F0b3Iub2Zmc2V0V2lkdGg7XG5cbnZhciBwb2ludGVyQXJyYXkgPSBbXTtcbnZhciBkaXN0YW5jZVByZXYgPSAwO1xudmFyIGN1cnJlbnRTY2FsZSA9IDE7XG5cbmltYWdlLnN0eWxlLmxlZnQgPSAnMHB4JztcbmltYWdlSW5kaWNhdG9yLnN0eWxlLmxlZnQgPSAnMHB4JztcblxuaW1hZ2Uuc3R5bGUudHJhbnNmb3JtID0gXCJzY2FsZShcIiArIGN1cnJlbnRTY2FsZSArIFwiKVwiO1xuXG5pbWFnZVNjYWxlLmlubmVySFRNTCA9IDEwMCArICclJztcbmltYWdlQnJpZ2h0bmVzcy5pbm5lckhUTUwgPSAxMDAgKyAnJSc7XG5cbnZhciBtb3ZlVG9TdGFydFBvc2l0aW9uID0gZnVuY3Rpb24oKSB7XG4gIGltYWdlV2luZG93ID0gaW1hZ2VDb250YWluZXIub2Zmc2V0V2lkdGg7XG4gIGltYWdlV2lkdGggPSBpbWFnZS5vZmZzZXRXaWR0aDtcbiAgaW1hZ2VJbmRpY2F0b3JXaWR0aCA9IGltYWdlSW5kaWNhdG9yLm9mZnNldFdpZHRoO1xuXG4gIGltYWdlLnN0eWxlLmxlZnQgPSAnMHB4JztcbiAgaW1hZ2VJbmRpY2F0b3Iuc3R5bGUubGVmdCA9ICcwcHgnO1xuXG4gIGltYWdlLnN0eWxlLnRyYW5zZm9ybSA9IFwic2NhbGUoXCIgKyAxICsgXCIpXCI7XG5cbiAgaW1hZ2VCcmlnaHRuZXNzLmlubmVySFRNTCA9ICcxMDAlJztcbiAgaW1hZ2VTY2FsZS5pbm5lckhUTUwgPSAnMTAwJSc7XG59O1xuXG5cbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCBmdW5jdGlvbigpIHtcbiAgbW92ZVRvU3RhcnRQb3NpdGlvbigpO1xufSk7XG5cblxuaW1hZ2VDb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcigncG9pbnRlcmRvd24nLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgaW1hZ2VDb250YWluZXIuc2V0UG9pbnRlckNhcHR1cmUoZXZlbnQucG9pbnRlcklkKTtcblxuICBwb2ludGVyQXJyYXkucHVzaCh7XG4gICAgaWQ6IGV2ZW50LnBvaW50ZXJJZCxcbiAgICBzdGFydFBvc2l0aW9uOiB7XG4gICAgICB4OiBldmVudC54LFxuICAgICAgeTogZXZlbnQueVxuICAgIH0sXG4gICAgcHJldlBvc2l0aW9uOiB7XG4gICAgICB4OiBldmVudC54LFxuICAgICAgeTogZXZlbnQueVxuICAgIH0sXG4gICAgY3VycmVudFBvc2l0aW9uOiB7XG4gICAgICB4OiBldmVudC54LFxuICAgICAgeTogZXZlbnQueVxuICAgIH1cbiAgfSk7XG59KTtcblxuXG5pbWFnZUNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdwb2ludGVybW92ZScsIGZ1bmN0aW9uIChldmVudCkge1xuICBpZiAocG9pbnRlckFycmF5Lmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVyblxuICB9XG5cbiAgdmFyIGluZGV4ID0gbnVsbDtcblxuICBmb3IgKHZhciBpID0gMDsgaSA8IHBvaW50ZXJBcnJheS5sZW5ndGg7IGkrKykge1xuICAgIGlmIChwb2ludGVyQXJyYXlbaV0uaWQgPT09IGV2ZW50LnBvaW50ZXJJZCkge1xuICAgICAgaW5kZXggPSBpO1xuICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG5cbiAgcG9pbnRlckFycmF5W2luZGV4XS5jdXJyZW50UG9zaXRpb24ueCA9IGV2ZW50Lng7XG4gIHBvaW50ZXJBcnJheVtpbmRleF0uY3VycmVudFBvc2l0aW9uLnkgPSBldmVudC55O1xuXG4gIGlmIChwb2ludGVyQXJyYXkubGVuZ3RoID4gMSkge1xuXG4gICAgdmFyIHN0YXJ0UG9zaXRpb25YMSA9IHBvaW50ZXJBcnJheVswXS5zdGFydFBvc2l0aW9uLng7XG4gICAgdmFyIHN0YXJ0UG9zaXRpb25ZMSA9IHBvaW50ZXJBcnJheVswXS5zdGFydFBvc2l0aW9uLnk7XG4gICAgdmFyIHN0YXJ0UG9zaXRpb25YMiA9IHBvaW50ZXJBcnJheVsxXS5zdGFydFBvc2l0aW9uLng7XG4gICAgdmFyIHN0YXJ0UG9zaXRpb25ZMiA9IHBvaW50ZXJBcnJheVsxXS5zdGFydFBvc2l0aW9uLnk7XG5cbiAgICB2YXIgY3VycmVudFBvc2l0aW9uWDEgPSBwb2ludGVyQXJyYXlbMF0uY3VycmVudFBvc2l0aW9uLng7XG4gICAgdmFyIGN1cnJlbnRQb3NpdGlvblkxID0gcG9pbnRlckFycmF5WzBdLmN1cnJlbnRQb3NpdGlvbi55O1xuICAgIHZhciBjdXJyZW50UG9zaXRpb25YMiA9IHBvaW50ZXJBcnJheVsxXS5jdXJyZW50UG9zaXRpb24ueDtcbiAgICB2YXIgY3VycmVudFBvc2l0aW9uWTIgPSBwb2ludGVyQXJyYXlbMV0uY3VycmVudFBvc2l0aW9uLnk7XG5cbiAgICAvLyBwaW5jaFxuICAgIHZhciBkaXN0YW5jZSA9IE1hdGguc3FydChNYXRoLnBvdygoY3VycmVudFBvc2l0aW9uWDIgLSBjdXJyZW50UG9zaXRpb25YMSksIDIpICsgTWF0aC5wb3coKGN1cnJlbnRQb3NpdGlvblkyIC0gY3VycmVudFBvc2l0aW9uWTEpLCAyKSk7XG5cbiAgICBpZiAoZGlzdGFuY2VQcmV2KSB7XG5cbiAgICAgIHZhciBzY2FsZSA9IDAuMDI7XG5cbiAgICAgIGlmIChkaXN0YW5jZSA+IGRpc3RhbmNlUHJldikge1xuICAgICAgICBjdXJyZW50U2NhbGUgKz0gc2NhbGU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjdXJyZW50U2NhbGUgLT0gc2NhbGU7XG4gICAgICAgIGlmIChjdXJyZW50U2NhbGUgPD0gMSkge1xuICAgICAgICAgIGN1cnJlbnRTY2FsZSA9IDE7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaW1hZ2Uuc3R5bGUudHJhbnNmb3JtID0gXCJzY2FsZShcIiArIGN1cnJlbnRTY2FsZSArIFwiKVwiO1xuICAgICAgaW1hZ2VTY2FsZS5pbm5lckhUTUwgPSBNYXRoLmNlaWwoY3VycmVudFNjYWxlICogMTAwKSArICclJztcbiAgICB9XG5cbiAgICBkaXN0YW5jZVByZXYgPSBkaXN0YW5jZTtcblxuICAgIC8vIHJvdGF0ZVxuICAgIHZhciBzdGFydEFuZ2xlID0gTWF0aC5hdGFuMihzdGFydFBvc2l0aW9uWTEgLSBzdGFydFBvc2l0aW9uWTIsIHN0YXJ0UG9zaXRpb25YMSAtIHN0YXJ0UG9zaXRpb25YMik7XG4gICAgdmFyIGN1cnJlbnRBbmdsZSA9IE1hdGguYXRhbjIoY3VycmVudFBvc2l0aW9uWTEgLSBjdXJyZW50UG9zaXRpb25ZMiwgY3VycmVudFBvc2l0aW9uWDEgLSBjdXJyZW50UG9zaXRpb25YMik7XG4gICAgdmFyIGFuZ2xlQ2hhbmdlID0gKGN1cnJlbnRBbmdsZSAtIHN0YXJ0QW5nbGUpICogMTgwIC8gTWF0aC5QSTtcblxuICAgIGlmIChhbmdsZUNoYW5nZSA8IDApIHtcbiAgICAgIGFuZ2xlQ2hhbmdlICs9IDM2MDtcbiAgICB9XG5cbiAgICB2YXIgYnJpZ2h0bmVzcyA9IDEwMCAtIChhbmdsZUNoYW5nZSAvIDM2MCAqIDEwMCk7XG5cbiAgICBpbWFnZS5zdHlsZS5maWx0ZXIgPSAnYnJpZ2h0bmVzcygnICsgYnJpZ2h0bmVzcyArICclKSc7XG4gICAgaW1hZ2VCcmlnaHRuZXNzLmlubmVySFRNTCA9IE1hdGguY2VpbChicmlnaHRuZXNzKSArICclJztcblxuICB9IGVsc2Uge1xuXG4gICAgLy8gbW92ZVxuICAgIHZhciBzdGFydFggPSBwb2ludGVyQXJyYXlbaW5kZXhdLnByZXZQb3NpdGlvbi54O1xuICAgIHZhciB4ID0gZXZlbnQueDtcbiAgICB2YXIgZHggPSB4IC0gc3RhcnRYO1xuXG4gICAgdmFyIGxlZnQgPSBpbWFnZS5zdHlsZS5sZWZ0LnJlcGxhY2UoJ3B4JywgJycpICogMTtcbiAgICB2YXIgbGVmdEluZGljYXRvciA9IGltYWdlSW5kaWNhdG9yLnN0eWxlLmxlZnQucmVwbGFjZSgncHgnLCAnJykgKiAxO1xuXG4gICAgdmFyIGRsZWZ0ID0gKGltYWdlV2luZG93IC0gaW1hZ2VJbmRpY2F0b3JXaWR0aCkgLyAoaW1hZ2VXaWR0aCAtIGltYWdlV2luZG93KTtcblxuICAgIGR4ID4gMCA/IGxlZnQgKz0gTWF0aC5hYnMoZHgpIDogbGVmdCAtPSBNYXRoLmFicyhkeCk7XG4gICAgZHggPiAwID8gbGVmdEluZGljYXRvciAtPSBNYXRoLmFicyhkeCkgKiBkbGVmdCA6IGxlZnRJbmRpY2F0b3IgKz0gTWF0aC5hYnMoZHgpICogZGxlZnQ7XG5cbiAgICBpZiAobGVmdCA+IDApIHtcbiAgICAgIGxlZnQgPSAwO1xuICAgICAgbGVmdEluZGljYXRvciA9IDA7XG4gICAgfVxuXG4gICAgaWYgKGxlZnQgPCBpbWFnZVdpbmRvdyAtIGltYWdlV2lkdGgpIHtcbiAgICAgIGxlZnQgPSBpbWFnZVdpbmRvdyAtIGltYWdlV2lkdGg7XG4gICAgICBsZWZ0SW5kaWNhdG9yID0gaW1hZ2VXaW5kb3cgLSBpbWFnZUluZGljYXRvcldpZHRoO1xuICAgIH1cblxuICAgIGltYWdlLnN0eWxlLmxlZnQgPSBsZWZ0ICsgJ3B4JztcbiAgICBwb2ludGVyQXJyYXlbaW5kZXhdLnByZXZQb3NpdGlvbi54ID0geDtcblxuICAgIGltYWdlSW5kaWNhdG9yLnN0eWxlLmxlZnQgPSBsZWZ0SW5kaWNhdG9yICsgJ3B4JztcbiAgfVxufSk7XG5cblxuaW1hZ2VDb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcigncG9pbnRlcnVwJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gIHZhciBpbmRleCA9IG51bGw7XG5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBwb2ludGVyQXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICBpZiAocG9pbnRlckFycmF5W2ldLmlkID09PSBldmVudC5wb2ludGVySWQpIHtcbiAgICAgIGluZGV4ID0gaTtcbiAgICB9XG4gIH1cblxuICBwb2ludGVyQXJyYXkuc3BsaWNlKHBvaW50ZXJBcnJheVtpbmRleF0sIDEpO1xufSk7XG5cblxuaW1hZ2VDb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcigncG9pbnRlcmNhbmNlbCcsIG1vdmVUb1N0YXJ0UG9zaXRpb24pO1xuXG4iXX0=
