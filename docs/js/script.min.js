var buttonMenu=document.querySelector(".js-menu-button"),menu=document.querySelector(".header-menu");buttonMenu.addEventListener("click",function(){menu.classList.toggle("header-menu--opened")});var data,grid=document.querySelector(".grid"),template=document.querySelector("#moduleTemplate"),moduleTemplate=template.content.querySelector(".module"),modulePicture=template.content.querySelector(".module__picture"),moduleDetails=template.content.querySelector(".module__cam-details"),xhr=new XMLHttpRequest;xhr.open("GET","events.json",!1),xhr.send(),200!=xhr.status?alert(xhr.status+": "+xhr.statusText):data=JSON.parse(xhr.responseText);var events=data.events;function createElementFromHTML(e){var t=document.createElement("div");return t.innerHTML=e.trim(),t.firstChild}function parseTemplate(e,t){var r=e.outerHTML;return Object.keys(t).forEach(function(e){null===t[e]&&(t[e]=""),r=r.replace("{{ "+e+" }}",t[e])}),createElementFromHTML(r)}for(var i=0;i<events.length;i++){var module=moduleTemplate.cloneNode(!0);if(module=parseTemplate(moduleTemplate,events[i]),""===events[i].description&&module.querySelector(".module__message").classList.add("module__message--disabled"),"data"in events[i]&&"cam"===events[i].icon){var picture=modulePicture.cloneNode(!0),details=moduleDetails.cloneNode(!0);module.querySelector(".module__message").appendChild(picture),module.querySelector(".module__message").appendChild(details)}grid.appendChild(module)}var imageContainer=document.querySelector(".module__picture"),image=document.querySelector(".module__image"),imageIndicator=document.querySelector(".module__indicator"),imageScale=document.querySelector(".module__scale strong"),imageBrightness=document.querySelector(".module__light strong"),imageWindow=imageContainer.offsetWidth,imageWidth=image.offsetWidth,pointerArray=[],distancePrev=0,currentScale=1;image.style.left="0px",imageIndicator.style.left="0px",image.style.transform="scale("+currentScale+")",imageScale.innerHTML="100%",imageBrightness.innerHTML="100%";var moveToStartPosition=function(){imageWindow=imageContainer.offsetWidth,image.style.left="0px",imageIndicator.style.left="0px",image.style.transform="scale(1)",imageBrightness.innerHTML="100%",imageScale.innerHTML="100%",imageWindow=imageContainer.offsetWidth,imageWidth=image.offsetWidth};window.addEventListener("resize",function(){moveToStartPosition()}),imageContainer.addEventListener("pointerdown",function(e){imageContainer.setPointerCapture(e.pointerId),pointerArray.push({id:e.pointerId,startPosition:{x:e.x,y:e.y},prevPosition:{x:e.x,y:e.y},currentPosition:{x:e.x,y:e.y}})}),imageContainer.addEventListener("pointermove",function(e){if(0!==pointerArray.length){for(var t=null,r=0;r<pointerArray.length;r++)if(pointerArray[r].id===e.pointerId){t=r;break}if(pointerArray[t].currentPosition.x=e.x,pointerArray[t].currentPosition.y=e.y,1<pointerArray.length){var i=pointerArray[0].currentPosition.x,n=pointerArray[0].currentPosition.y,a=pointerArray[1].currentPosition.x,o=pointerArray[1].currentPosition.y,l=Math.sqrt(Math.pow(a-i,2)+Math.pow(o-n,2));if(distancePrev){distancePrev<l?currentScale+=.01:(currentScale-=.01)<=1&&(currentScale=1),image.style.transform="scale("+currentScale+")",imageScale.innerHTML=Math.ceil(100*currentScale)+"%"}distancePrev=l;var s=pointerArray[0].startPosition.x,m=pointerArray[0].startPosition.y,d=pointerArray[1].startPosition.x,c=pointerArray[1].startPosition.y,u=Math.atan2(m-c,s-d),p=180*(Math.atan2(n-o,i-a)-u)/Math.PI;p<0&&(p+=360);var g=p/360*100;image.style.filter="brightness("+g+"%)",imageBrightness.innerHTML=Math.ceil(g)+"%",console.log(g)}else{var y=pointerArray[t].prevPosition.x,h=e.x,v=h-y,f=1*image.style.left.replace("px","");0<v?f+=Math.abs(v):f-=Math.abs(v),0<f&&(f=0),f<imageWindow-imageWidth&&(f=imageWindow-imageWidth),image.style.left=f+"px",pointerArray[t].prevPosition.x=h}}}),imageContainer.addEventListener("pointerup",function(e){for(var t=null,r=0;r<pointerArray.length;r++)pointerArray[r].id===e.pointerId&&(t=r);pointerArray.splice(pointerArray[t],1)}),imageContainer.addEventListener("pointercancel",moveToStartPosition);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJidXR0b25NZW51IiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwibWVudSIsImFkZEV2ZW50TGlzdGVuZXIiLCJjbGFzc0xpc3QiLCJ0b2dnbGUiLCJkYXRhIiwiZ3JpZCIsInRlbXBsYXRlIiwibW9kdWxlVGVtcGxhdGUiLCJjb250ZW50IiwibW9kdWxlUGljdHVyZSIsIm1vZHVsZURldGFpbHMiLCJ4aHIiLCJYTUxIdHRwUmVxdWVzdCIsIm9wZW4iLCJzZW5kIiwic3RhdHVzIiwiYWxlcnQiLCJzdGF0dXNUZXh0IiwiSlNPTiIsInBhcnNlIiwicmVzcG9uc2VUZXh0IiwiZXZlbnRzIiwiY3JlYXRlRWxlbWVudEZyb21IVE1MIiwiaHRtbFN0cmluZyIsImRpdiIsImNyZWF0ZUVsZW1lbnQiLCJpbm5lckhUTUwiLCJ0cmltIiwiZmlyc3RDaGlsZCIsInBhcnNlVGVtcGxhdGUiLCJ2YXJpYWJsZXMiLCJyZXN1bHQiLCJvdXRlckhUTUwiLCJPYmplY3QiLCJrZXlzIiwiZm9yRWFjaCIsImtleSIsInJlcGxhY2UiLCJpIiwibGVuZ3RoIiwibW9kdWxlIiwiY2xvbmVOb2RlIiwiZGVzY3JpcHRpb24iLCJhZGQiLCJpY29uIiwicGljdHVyZSIsImRldGFpbHMiLCJhcHBlbmRDaGlsZCIsImltYWdlQ29udGFpbmVyIiwiaW1hZ2UiLCJpbWFnZUluZGljYXRvciIsImltYWdlU2NhbGUiLCJpbWFnZUJyaWdodG5lc3MiLCJpbWFnZVdpbmRvdyIsIm9mZnNldFdpZHRoIiwiaW1hZ2VXaWR0aCIsInBvaW50ZXJBcnJheSIsImRpc3RhbmNlUHJldiIsImN1cnJlbnRTY2FsZSIsInN0eWxlIiwibGVmdCIsInRyYW5zZm9ybSIsIm1vdmVUb1N0YXJ0UG9zaXRpb24iLCJ3aW5kb3ciLCJldmVudCIsInNldFBvaW50ZXJDYXB0dXJlIiwicG9pbnRlcklkIiwicHVzaCIsImlkIiwic3RhcnRQb3NpdGlvbiIsIngiLCJ5IiwicHJldlBvc2l0aW9uIiwiY3VycmVudFBvc2l0aW9uIiwiaW5kZXgiLCJjdXJyZW50UG9zaXRpb25YMSIsImN1cnJlbnRQb3NpdGlvblkxIiwiY3VycmVudFBvc2l0aW9uWDIiLCJjdXJyZW50UG9zaXRpb25ZMiIsImRpc3RhbmNlIiwiTWF0aCIsInNxcnQiLCJwb3ciLCJjZWlsIiwic3RhcnRQb3NpdGlvblgxIiwic3RhcnRQb3NpdGlvblkxIiwic3RhcnRQb3NpdGlvblgyIiwic3RhcnRQb3NpdGlvblkyIiwic3RhcnRBbmdsZSIsImF0YW4yIiwiYW5nbGVDaGFuZ2UiLCJQSSIsImJyaWdodG5lc3MiLCJmaWx0ZXIiLCJjb25zb2xlIiwibG9nIiwic3RhcnRYIiwiZHgiLCJhYnMiLCJzcGxpY2UiXSwibWFwcGluZ3MiOiJBQUFBLElBQUlBLFdBQWFDLFNBQVNDLGNBQWMsbUJBQ3BDQyxLQUFPRixTQUFTQyxjQUFjLGdCQUVsQ0YsV0FBV0ksaUJBQWlCLFFBQVMsV0FDbkNELEtBQUtFLFVBQVVDLE9BQU8seUJBR3hCLElBUUlDLEtBUkFDLEtBQU9QLFNBQVNDLGNBQWMsU0FFOUJPLFNBQVdSLFNBQVNDLGNBQWMsbUJBRWxDUSxlQUFpQkQsU0FBU0UsUUFBUVQsY0FBYyxXQUNoRFUsY0FBZ0JILFNBQVNFLFFBQVFULGNBQWMsb0JBQy9DVyxjQUFnQkosU0FBU0UsUUFBUVQsY0FBYyx3QkFJL0NZLElBQU0sSUFBSUMsZUFDZEQsSUFBSUUsS0FBSyxNQUFPLGVBQWUsR0FDL0JGLElBQUlHLE9BQ2MsS0FBZEgsSUFBSUksT0FDTkMsTUFBT0wsSUFBSUksT0FBUyxLQUFPSixJQUFJTSxZQUUvQmIsS0FBT2MsS0FBS0MsTUFBTVIsSUFBSVMsY0FHeEIsSUFBSUMsT0FBU2pCLEtBQUtpQixPQUVsQixTQUFTQyxzQkFBc0JDLEdBQzdCLElBQUlDLEVBQU0xQixTQUFTMkIsY0FBYyxPQUVqQyxPQURBRCxFQUFJRSxVQUFZSCxFQUFXSSxPQUNwQkgsRUFBSUksV0FHYixTQUFTQyxjQUFjdkIsRUFBVXdCLEdBQy9CLElBQUlD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LFlBR3ZCTixNQUFNVSxNQUFNQyxLQUFPQSxFQUFPLEtBQzFCSixhQUFha0IsR0FBT0YsYUFBYUYsRUFBSUEsTUFJekN0QixlQUFlL0MsaUJBQWlCLFlBQWEsU0FBVStELEdBR3JELElBRkEsSUFBSVUsRUFBUSxLQUVIcEMsRUFBSSxFQUFHQSxFQUFJa0IsYUFBYWpCLE9BQVFELElBQ25Da0IsYUFBYWxCLEdBQUc4QixLQUFPSixFQUFNRSxZQUMvQlEsRUFBUXBDLEdBSVprQixhQUFhMkMsT0FBTzNDLGFBQWFrQixHQUFRLEtBRzNDMUIsZUFBZS9DLGlCQUFpQixnQkFBaUI2RCIsImZpbGUiOiJzY3JpcHQubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGJ1dHRvbk1lbnUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuanMtbWVudS1idXR0b24nKTtcbnZhciBtZW51ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmhlYWRlci1tZW51Jyk7XG5cbmJ1dHRvbk1lbnUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gIG1lbnUuY2xhc3NMaXN0LnRvZ2dsZSgnaGVhZGVyLW1lbnUtLW9wZW5lZCcpO1xufSk7XG5cbnZhciBncmlkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmdyaWQnKTtcblxudmFyIHRlbXBsYXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI21vZHVsZVRlbXBsYXRlJyk7XG5cbnZhciBtb2R1bGVUZW1wbGF0ZSA9IHRlbXBsYXRlLmNvbnRlbnQucXVlcnlTZWxlY3RvcignLm1vZHVsZScpO1xudmFyIG1vZHVsZVBpY3R1cmUgPSB0ZW1wbGF0ZS5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2R1bGVfX3BpY3R1cmUnKTtcbnZhciBtb2R1bGVEZXRhaWxzID0gdGVtcGxhdGUuY29udGVudC5xdWVyeVNlbGVjdG9yKCcubW9kdWxlX19jYW0tZGV0YWlscycpO1xuXG52YXIgZGF0YTtcblxudmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xueGhyLm9wZW4oJ0dFVCcsICdldmVudHMuanNvbicsIGZhbHNlKTtcbnhoci5zZW5kKCk7XG5pZiAoeGhyLnN0YXR1cyAhPSAyMDApIHtcbiAgYWxlcnQoIHhoci5zdGF0dXMgKyAnOiAnICsgeGhyLnN0YXR1c1RleHQgKTtcbn0gZWxzZSB7XG4gIGRhdGEgPSBKU09OLnBhcnNlKHhoci5yZXNwb25zZVRleHQpO1xufVxuXG52YXIgZXZlbnRzID0gZGF0YS5ldmVudHM7XG5cbmZ1bmN0aW9uIGNyZWF0ZUVsZW1lbnRGcm9tSFRNTChodG1sU3RyaW5nKSB7XG4gIHZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgZGl2LmlubmVySFRNTCA9IGh0bWxTdHJpbmcudHJpbSgpO1xuICByZXR1cm4gZGl2LmZpcnN0Q2hpbGQ7XG59XG5cbmZ1bmN0aW9uIHBhcnNlVGVtcGxhdGUodGVtcGxhdGUsIHZhcmlhYmxlcykge1xuICB2YXIgcmVzdWx0ID0gdGVtcGxhdGUub3V0ZXJIVE1MO1xuICBPYmplY3Qua2V5cyh2YXJpYWJsZXMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgIGlmICh2YXJpYWJsZXNba2V5XSA9PT0gbnVsbCkge1xuICAgICAgdmFyaWFibGVzW2tleV0gPSAnJztcbiAgICB9XG4gICAgcmVzdWx0ID0gcmVzdWx0LnJlcGxhY2UoJ3t7ICcgKyBrZXkgKyAnIH19JywgdmFyaWFibGVzW2tleV0pO1xuICB9KTtcbiAgcmV0dXJuIGNyZWF0ZUVsZW1lbnRGcm9tSFRNTChyZXN1bHQpO1xufVxuXG5mb3IgKHZhciBpID0gMDsgaSA8IGV2ZW50cy5sZW5ndGg7IGkrKykge1xuXG4gIHZhciBtb2R1bGUgPSBtb2R1bGVUZW1wbGF0ZS5jbG9uZU5vZGUodHJ1ZSk7XG4gIG1vZHVsZSA9IHBhcnNlVGVtcGxhdGUobW9kdWxlVGVtcGxhdGUsIGV2ZW50c1tpXSk7XG5cbiAgaWYgKGV2ZW50c1tpXS5kZXNjcmlwdGlvbiA9PT0gJycpIHtcbiAgICBtb2R1bGUucXVlcnlTZWxlY3RvcignLm1vZHVsZV9fbWVzc2FnZScpLmNsYXNzTGlzdC5hZGQoJ21vZHVsZV9fbWVzc2FnZS0tZGlzYWJsZWQnKTtcbiAgfVxuXG4gIGlmICgnZGF0YScgaW4gZXZlbnRzW2ldKSB7XG5cbiAgICBpZiAoZXZlbnRzW2ldLmljb24gPT09ICdjYW0nKSB7XG4gICAgICB2YXIgcGljdHVyZSA9IG1vZHVsZVBpY3R1cmUuY2xvbmVOb2RlKHRydWUpO1xuICAgICAgdmFyIGRldGFpbHMgPSBtb2R1bGVEZXRhaWxzLmNsb25lTm9kZSh0cnVlKTtcbiAgICAgIG1vZHVsZS5xdWVyeVNlbGVjdG9yKCcubW9kdWxlX19tZXNzYWdlJykuYXBwZW5kQ2hpbGQocGljdHVyZSk7XG4gICAgICBtb2R1bGUucXVlcnlTZWxlY3RvcignLm1vZHVsZV9fbWVzc2FnZScpLmFwcGVuZENoaWxkKGRldGFpbHMpO1xuICAgIH1cblxuICB9XG5cbiAgZ3JpZC5hcHBlbmRDaGlsZChtb2R1bGUpO1xufVxuXG52YXIgaW1hZ2VDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kdWxlX19waWN0dXJlJyk7XG52YXIgaW1hZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kdWxlX19pbWFnZScpO1xudmFyIGltYWdlSW5kaWNhdG9yID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZHVsZV9faW5kaWNhdG9yJyk7XG52YXIgaW1hZ2VTY2FsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2R1bGVfX3NjYWxlIHN0cm9uZycpO1xudmFyIGltYWdlQnJpZ2h0bmVzcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2R1bGVfX2xpZ2h0IHN0cm9uZycpO1xuXG52YXIgaW1hZ2VXaW5kb3cgPSBpbWFnZUNvbnRhaW5lci5vZmZzZXRXaWR0aDtcbnZhciBpbWFnZVdpZHRoID0gaW1hZ2Uub2Zmc2V0V2lkdGg7XG5cbnZhciBwb2ludGVyQXJyYXkgPSBbXTtcbnZhciBkaXN0YW5jZVByZXYgPSAwO1xudmFyIGN1cnJlbnRTY2FsZSA9IDE7XG5cbmltYWdlLnN0eWxlLmxlZnQgPSAnMHB4JztcbmltYWdlSW5kaWNhdG9yLnN0eWxlLmxlZnQgPSAnMHB4JztcbmltYWdlLnN0eWxlLnRyYW5zZm9ybSA9IFwic2NhbGUoXCIgKyBjdXJyZW50U2NhbGUgKyBcIilcIjtcbmltYWdlU2NhbGUuaW5uZXJIVE1MID0gMTAwICsgJyUnO1xuaW1hZ2VCcmlnaHRuZXNzLmlubmVySFRNTCA9IDEwMCArICclJztcblxudmFyIG1vdmVUb1N0YXJ0UG9zaXRpb24gPSBmdW5jdGlvbigpIHtcbiAgaW1hZ2VXaW5kb3cgPSBpbWFnZUNvbnRhaW5lci5vZmZzZXRXaWR0aDtcbiAgaW1hZ2Uuc3R5bGUubGVmdCA9ICcwcHgnO1xuICBpbWFnZUluZGljYXRvci5zdHlsZS5sZWZ0ID0gJzBweCc7XG4gIGltYWdlLnN0eWxlLnRyYW5zZm9ybSA9IFwic2NhbGUoXCIgKyAxICsgXCIpXCI7XG5cbiAgaW1hZ2VCcmlnaHRuZXNzLmlubmVySFRNTCA9ICcxMDAlJztcbiAgaW1hZ2VTY2FsZS5pbm5lckhUTUwgPSAnMTAwJSc7XG5cbiAgaW1hZ2VXaW5kb3cgPSBpbWFnZUNvbnRhaW5lci5vZmZzZXRXaWR0aDtcbiAgaW1hZ2VXaWR0aCA9IGltYWdlLm9mZnNldFdpZHRoO1xufTtcblxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIGZ1bmN0aW9uKCkge1xuICBtb3ZlVG9TdGFydFBvc2l0aW9uKCk7XG59KTtcblxuaW1hZ2VDb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcigncG9pbnRlcmRvd24nLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgaW1hZ2VDb250YWluZXIuc2V0UG9pbnRlckNhcHR1cmUoZXZlbnQucG9pbnRlcklkKTtcblxuICBwb2ludGVyQXJyYXkucHVzaCh7XG4gICAgaWQ6IGV2ZW50LnBvaW50ZXJJZCxcbiAgICBzdGFydFBvc2l0aW9uOiB7XG4gICAgICB4OiBldmVudC54LFxuICAgICAgeTogZXZlbnQueVxuICAgIH0sXG4gICAgcHJldlBvc2l0aW9uOiB7XG4gICAgICB4OiBldmVudC54LFxuICAgICAgeTogZXZlbnQueVxuICAgIH0sXG4gICAgY3VycmVudFBvc2l0aW9uOiB7XG4gICAgICB4OiBldmVudC54LFxuICAgICAgeTogZXZlbnQueVxuICAgIH1cbiAgfSk7XG59KTtcblxuaW1hZ2VDb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcigncG9pbnRlcm1vdmUnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgaWYgKHBvaW50ZXJBcnJheS5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm5cbiAgfVxuXG4gIHZhciBpbmRleCA9IG51bGw7XG5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBwb2ludGVyQXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICBpZiAocG9pbnRlckFycmF5W2ldLmlkID09PSBldmVudC5wb2ludGVySWQpIHtcbiAgICAgIGluZGV4ID0gaTtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIHBvaW50ZXJBcnJheVtpbmRleF0uY3VycmVudFBvc2l0aW9uLnggPSBldmVudC54O1xuICBwb2ludGVyQXJyYXlbaW5kZXhdLmN1cnJlbnRQb3NpdGlvbi55ID0gZXZlbnQueTtcblxuICBpZiAocG9pbnRlckFycmF5Lmxlbmd0aCA+IDEpIHtcblxuICAgIHZhciBjdXJyZW50UG9zaXRpb25YMSA9IHBvaW50ZXJBcnJheVswXS5jdXJyZW50UG9zaXRpb24ueDtcbiAgICB2YXIgY3VycmVudFBvc2l0aW9uWTEgPSBwb2ludGVyQXJyYXlbMF0uY3VycmVudFBvc2l0aW9uLnk7XG4gICAgdmFyIGN1cnJlbnRQb3NpdGlvblgyID0gcG9pbnRlckFycmF5WzFdLmN1cnJlbnRQb3NpdGlvbi54O1xuICAgIHZhciBjdXJyZW50UG9zaXRpb25ZMiA9IHBvaW50ZXJBcnJheVsxXS5jdXJyZW50UG9zaXRpb24ueTtcblxuICAgIC8vIHBpbmNoXG4gICAgdmFyIGRpc3RhbmNlID0gTWF0aC5zcXJ0KE1hdGgucG93KChjdXJyZW50UG9zaXRpb25YMiAtIGN1cnJlbnRQb3NpdGlvblgxKSwgMikgKyBNYXRoLnBvdygoY3VycmVudFBvc2l0aW9uWTIgLSBjdXJyZW50UG9zaXRpb25ZMSksIDIpKTtcblxuICAgIGlmIChkaXN0YW5jZVByZXYpIHtcblxuICAgICAgdmFyIHNjYWxlID0gMC4wMTtcblxuICAgICAgaWYgKGRpc3RhbmNlID4gZGlzdGFuY2VQcmV2KSB7XG4gICAgICAgIGN1cnJlbnRTY2FsZSArPSBzY2FsZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGN1cnJlbnRTY2FsZSAtPSBzY2FsZTtcbiAgICAgICAgaWYgKGN1cnJlbnRTY2FsZSA8PSAxKSB7XG4gICAgICAgICAgY3VycmVudFNjYWxlID0gMTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpbWFnZS5zdHlsZS50cmFuc2Zvcm0gPSBcInNjYWxlKFwiICsgY3VycmVudFNjYWxlICsgXCIpXCI7XG4gICAgICBpbWFnZVNjYWxlLmlubmVySFRNTCA9IE1hdGguY2VpbChjdXJyZW50U2NhbGUgKiAxMDApICsgJyUnO1xuICAgIH1cblxuICAgIGRpc3RhbmNlUHJldiA9IGRpc3RhbmNlO1xuXG4gICAgLy8gcm90YXRlXG4gICAgdmFyIHN0YXJ0UG9zaXRpb25YMSA9IHBvaW50ZXJBcnJheVswXS5zdGFydFBvc2l0aW9uLng7XG4gICAgdmFyIHN0YXJ0UG9zaXRpb25ZMSA9IHBvaW50ZXJBcnJheVswXS5zdGFydFBvc2l0aW9uLnk7XG4gICAgdmFyIHN0YXJ0UG9zaXRpb25YMiA9IHBvaW50ZXJBcnJheVsxXS5zdGFydFBvc2l0aW9uLng7XG4gICAgdmFyIHN0YXJ0UG9zaXRpb25ZMiA9IHBvaW50ZXJBcnJheVsxXS5zdGFydFBvc2l0aW9uLnk7XG5cbiAgICB2YXIgc3RhcnRBbmdsZSA9IE1hdGguYXRhbjIoc3RhcnRQb3NpdGlvblkxIC0gc3RhcnRQb3NpdGlvblkyLCBzdGFydFBvc2l0aW9uWDEgLSBzdGFydFBvc2l0aW9uWDIpO1xuICAgIHZhciBjdXJyZW50QW5nbGUgPSBNYXRoLmF0YW4yKGN1cnJlbnRQb3NpdGlvblkxIC0gY3VycmVudFBvc2l0aW9uWTIsIGN1cnJlbnRQb3NpdGlvblgxIC0gY3VycmVudFBvc2l0aW9uWDIpO1xuICAgIHZhciBhbmdsZUNoYW5nZSA9IChjdXJyZW50QW5nbGUgLSBzdGFydEFuZ2xlKSAqIDE4MCAvIE1hdGguUEk7XG5cbiAgICBpZiAoYW5nbGVDaGFuZ2UgPCAwKSB7XG4gICAgICBhbmdsZUNoYW5nZSArPSAzNjA7XG4gICAgfVxuXG4gICAgdmFyIGJyaWdodG5lc3MgPSBhbmdsZUNoYW5nZSAvIDM2MCAqIDEwMDtcblxuICAgIGltYWdlLnN0eWxlLmZpbHRlciA9ICdicmlnaHRuZXNzKCcgKyBicmlnaHRuZXNzICsgJyUpJztcbiAgICBpbWFnZUJyaWdodG5lc3MuaW5uZXJIVE1MID0gTWF0aC5jZWlsKGJyaWdodG5lc3MpICsgJyUnO1xuXG4gICAgY29uc29sZS5sb2coYnJpZ2h0bmVzcyk7XG5cbiAgfSBlbHNlIHtcblxuICAgIC8vIG1vdmVcbiAgICB2YXIgc3RhcnRYID0gcG9pbnRlckFycmF5W2luZGV4XS5wcmV2UG9zaXRpb24ueDtcbiAgICB2YXIgeCA9IGV2ZW50Lng7XG4gICAgdmFyIGR4ID0geCAtIHN0YXJ0WDtcbiAgICB2YXIgbGVmdCA9IGltYWdlLnN0eWxlLmxlZnQucmVwbGFjZSgncHgnLCAnJykgKiAxO1xuXG4gICAgZHggPiAwID8gbGVmdCArPSBNYXRoLmFicyhkeCkgOiBsZWZ0IC09IE1hdGguYWJzKGR4KTtcblxuICAgIGlmIChsZWZ0ID4gMCkge1xuICAgICAgbGVmdCA9IDA7XG4gICAgfVxuXG4gICAgaWYgKGxlZnQgPCBpbWFnZVdpbmRvdyAtIGltYWdlV2lkdGgpIHtcbiAgICAgIGxlZnQgPSBpbWFnZVdpbmRvdyAtIGltYWdlV2lkdGg7XG4gICAgfVxuXG4gICAgaW1hZ2Uuc3R5bGUubGVmdCA9IGxlZnQgKyAncHgnO1xuICAgIHBvaW50ZXJBcnJheVtpbmRleF0ucHJldlBvc2l0aW9uLnggPSB4O1xuICB9XG59KTtcblxuaW1hZ2VDb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcigncG9pbnRlcnVwJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gIHZhciBpbmRleCA9IG51bGw7XG5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBwb2ludGVyQXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICBpZiAocG9pbnRlckFycmF5W2ldLmlkID09PSBldmVudC5wb2ludGVySWQpIHtcbiAgICAgIGluZGV4ID0gaTtcbiAgICB9XG4gIH1cblxuICBwb2ludGVyQXJyYXkuc3BsaWNlKHBvaW50ZXJBcnJheVtpbmRleF0sIDEpO1xufSk7XG5cbmltYWdlQ29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ3BvaW50ZXJjYW5jZWwnLCBtb3ZlVG9TdGFydFBvc2l0aW9uKTtcblxuIl19
