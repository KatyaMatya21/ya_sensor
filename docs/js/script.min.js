var buttonMenu=document.querySelector(".js-menu-button"),menu=document.querySelector(".header-menu");buttonMenu.addEventListener("click",function(){menu.classList.toggle("header-menu--opened")});var data,grid=document.querySelector(".grid"),template=document.querySelector("#moduleTemplate"),moduleTemplate=template.content.querySelector(".module"),modulePicture=template.content.querySelector(".module__picture"),xhr=new XMLHttpRequest;xhr.open("GET","events.json",!1),xhr.send(),200!=xhr.status?alert(xhr.status+": "+xhr.statusText):data=JSON.parse(xhr.responseText);var events=data.events;function createElementFromHTML(e){var t=document.createElement("div");return t.innerHTML=e.trim(),t.firstChild}function parseTemplate(e,t){var r=e.outerHTML;return Object.keys(t).forEach(function(e){null===t[e]&&(t[e]=""),r=r.replace("{{ "+e+" }}",t[e])}),createElementFromHTML(r)}for(var i=0;i<events.length;i++){var module=moduleTemplate.cloneNode(!0);if(module=parseTemplate(moduleTemplate,events[i]),""===events[i].description&&module.querySelector(".module__message").classList.add("module__message--disabled"),"data"in events[i]&&"cam"===events[i].icon){var picture=modulePicture.cloneNode(!0);module.querySelector(".module__message").appendChild(picture)}grid.appendChild(module)}var imageContainer=document.querySelector(".module__picture"),image=document.querySelector(".module__image"),imageWindow=imageContainer.offsetWidth,imageWidth=image.offsetWidth,pointerArray=[],distancePrev=0,currentScale=1;image.style.left="0px",image.style.transform="scale("+currentScale+")";var moveToStartPosition=function(){imageWindow=imageContainer.offsetWidth,image.style.left="0px",imageWindow=imageContainer.offsetWidth,imageWidth=image.offsetWidth};window.addEventListener("resize",function(){moveToStartPosition()}),imageContainer.addEventListener("pointerdown",function(e){imageContainer.setPointerCapture(e.pointerId),pointerArray.push({id:e.pointerId,prevPosition:{x:e.x,y:e.y},currentPosition:{x:e.x,y:e.y}})}),imageContainer.addEventListener("pointermove",function(e){if(0!==pointerArray.length){for(var t=null,r=0;r<pointerArray.length;r++)if(pointerArray[r].id===e.pointerId){t=r;break}if(pointerArray[t].currentPosition.x=e.x,pointerArray[t].currentPosition.y=e.y,1<pointerArray.length){document.querySelector("body").style.background="green";var n=pointerArray[0].currentPosition.x,i=pointerArray[0].currentPosition.y,o=pointerArray[1].currentPosition.x,a=pointerArray[1].currentPosition.y,d=Math.sqrt(Math.pow(o-n,2)+Math.pow(a-i,2));if(distancePrev){distancePrev<d?(document.querySelector("body").style.background="red",currentScale+=.01):(document.querySelector("body").style.background="blue",(currentScale-=.01)<=1&&(currentScale=1)),image.style.transform="scale("+currentScale+")"}distancePrev=d}else{var u=pointerArray[t].prevPosition.x,l=e.x,s=l-u,c=1*image.style.left.replace("px","");0<s?c+=Math.abs(s):c-=Math.abs(s),0<c&&(c=0),c<imageWindow-imageWidth&&(c=imageWindow-imageWidth),image.style.left=c+"px",pointerArray[t].prevPosition.x=l}}}),imageContainer.addEventListener("pointerup",function(e){for(var t=null,r=0;r<pointerArray.length;r++)pointerArray[r].id===e.pointerId&&(t=r);pointerArray.splice(pointerArray[t],1)}),imageContainer.addEventListener("pointercancel",moveToStartPosition);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJidXR0b25NZW51IiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwibWVudSIsImFkZEV2ZW50TGlzdGVuZXIiLCJjbGFzc0xpc3QiLCJ0b2dnbGUiLCJkYXRhIiwiZ3JpZCIsInRlbXBsYXRlIiwibW9kdWxlVGVtcGxhdGUiLCJjb250ZW50IiwibW9kdWxlUGljdHVyZSIsInhociIsIlhNTEh0dHBSZXF1ZXN0Iiwib3BlbiIsInNlbmQiLCJzdGF0dXMiLCJhbGVydCIsInN0YXR1c1RleHQiLCJKU09OIiwicGFyc2UiLCJyZXNwb25zZVRleHQiLCJldmVudHMiLCJjcmVhdGVFbGVtZW50RnJvbUhUTUwiLCJodG1sU3RyaW5nIiwiZGl2IiwiY3JlYXRlRWxlbWVudCIsImlubmVySFRNTCIsInRyaW0iLCJmaXJzdENoaWxkIiwicGFyc2VUZW1wbGF0ZSIsInZhcmlhYmxlcyIsInJlc3VsdCIsIm91dGVySFRNTCIsIk9iamVjdCIsImtleXMiLCJmb3JFYWNoIiwia2V5IiwicmVwbGFjZSIsImkiLCJsZW5ndGgiLCJtb2R1bGUiLCJjbG9uZU5vZGUiLCJkZXNjcmlwdGlvbiIsImFkZCIsImljb24iLCJwaWN0dXJlIiwiYXBwZW5kQ2hpbGQiLCJpbWFnZUNvbnRhaW5lciIsImltYWdlIiwiaW1hZ2VXaW5kb3ciLCJvZmZzZXRXaWR0aCIsImltYWdlV2lkdGgiLCJwb2ludGVyQXJyYXkiLCJkaXN0YW5jZVByZXYiLCJjdXJyZW50U2NhbGUiLCJzdHlsZSIsImxlZnQiLCJ0cmFuc2Zvcm0iLCJtb3ZlVG9TdGFydFBvc2l0aW9uIiwid2luZG93IiwiZXZlbnQiLCJzZXRQb2ludGVyQ2FwdHVyZSIsInBvaW50ZXJJZCIsInB1c2giLCJpZCIsInByZXZQb3NpdGlvbiIsIngiLCJ5IiwiY3VycmVudFBvc2l0aW9uIiwiaW5kZXgiLCJiYWNrZ3JvdW5kIiwiY3VycmVudFBvc2l0aW9uWDEiLCJjdXJyZW50UG9zaXRpb25ZMSIsImN1cnJlbnRQb3NpdGlvblgyIiwiY3VycmVudFBvc2l0aW9uWTIiLCJkaXN0YW5jZSIsIk1hdGgiLCJzcXJ0IiwicG93Iiwic3RhcnRYIiwiZHgiLCJhYnMiLCJzcGxpY2UiXSwibWFwcGluZ3MiOiJBQUFBLElBQUlBLFdBQWFDLFNBQVNDLGNBQWMsbUJBQ3BDQyxLQUFPRixTQUFTQyxjQUFjLGdCQUVsQ0YsV0FBV0ksaUJBQWlCLFFBQVMsV0FDbkNELEtBQUtFLFVBQVVDLE9BQU8seUJBR3hCLElBT0lDLEtBUEFDLEtBQU9QLFNBQVNDLGNBQWMsU0FFOUJPLFNBQVdSLFNBQVNDLGNBQWMsbUJBRWxDUSxlQUFpQkQsU0FBU0UsUUFBUVQsY0FBYyxXQUNoRFUsY0FBZ0JILFNBQVNFLFFBQVFULGNBQWMsb0JBSS9DVyxJQUFNLElBQUlDLGVBQ2RELElBQUlFLEtBQUssTUFBTyxlQUFlLEdBQy9CRixJQUFJRyxPQUNjLEtBQWRILElBQUlJLE9BQ05DLE1BQU9MLElBQUlJLE9BQVMsS0FBT0osSUFBSU0sWUFFL0JaLEtBQU9hLEtBQUtDLE1BQU1SLElBQUlTLGNBR3hCLElBQUlDLE9BQVNoQixLQUFLZ0IsT0FFbEIsU0FBU0Msc0JBQXNCQyxHQUM3QixJQUFJQyxFQUFNekIsU0FBUzBCLGNBQWMsT0FFakMsT0FEQUQsRUFBSUUsVUFBWUgsRUFBV0ksT0FDcEJILEVBQUlJLFdBR2IsU0FBU0MsY0FBY3RCLEVBQVV1QixHQUMvQixJQUFJQyxFQUFTeEIsRUFBU3lCLFVBT3RCLE9BTkFDLE9BQU9DLEtBQUtKLEdBQVdLLFFBQVEsU0FBVUMsR0FDaEIsT0FBbkJOLEVBQVVNLEtBQ1pOLEVBQVVNLEdBQU8sSUFFbkJMLEVBQVNBLEVBQU9NLFFBQVEsTUFBUUQsRUFBTSxNQUFPTixFQUFVTSxNQUVsRGQsc0JBQXNCUyxHQUcvQixJQUFLLElBQUlPLEVBQUksRUFBR0EsRUFBSWpCLE9BQU9rQixPQUFRRCxJQUFLLENBRXRDLElBQUlFLE9BQVNoQyxlQUFlaUMsV0FBVSxHQU90QyxHQU5BRCxPQUFTWCxjQUFjckIsZUFB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SXpDbkIsZUFBZTdDLGlCQUFpQixZQUFhLFNBQVUwRCxHQUdyRCxJQUZBLElBQUlTLEVBQVEsS0FFSC9CLEVBQUksRUFBR0EsRUFBSWMsYUFBYWIsT0FBUUQsSUFDbkNjLGFBQWFkLEdBQUcwQixLQUFPSixFQUFNRSxZQUMvQk8sRUFBUS9CLEdBSVpjLGFBQWE4QixPQUFPOUIsYUFBYWlCLEdBQVEsS0FHM0N0QixlQUFlN0MsaUJBQWlCLGdCQUFpQndEIiwiZmlsZSI6InNjcmlwdC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgYnV0dG9uTWVudSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5qcy1tZW51LWJ1dHRvbicpO1xudmFyIG1lbnUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaGVhZGVyLW1lbnUnKTtcblxuYnV0dG9uTWVudS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgbWVudS5jbGFzc0xpc3QudG9nZ2xlKCdoZWFkZXItbWVudS0tb3BlbmVkJyk7XG59KTtcblxudmFyIGdyaWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZ3JpZCcpO1xuXG52YXIgdGVtcGxhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbW9kdWxlVGVtcGxhdGUnKTtcblxudmFyIG1vZHVsZVRlbXBsYXRlID0gdGVtcGxhdGUuY29udGVudC5xdWVyeVNlbGVjdG9yKCcubW9kdWxlJyk7XG52YXIgbW9kdWxlUGljdHVyZSA9IHRlbXBsYXRlLmNvbnRlbnQucXVlcnlTZWxlY3RvcignLm1vZHVsZV9fcGljdHVyZScpO1xuXG52YXIgZGF0YTtcblxudmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xueGhyLm9wZW4oJ0dFVCcsICdldmVudHMuanNvbicsIGZhbHNlKTtcbnhoci5zZW5kKCk7XG5pZiAoeGhyLnN0YXR1cyAhPSAyMDApIHtcbiAgYWxlcnQoIHhoci5zdGF0dXMgKyAnOiAnICsgeGhyLnN0YXR1c1RleHQgKTtcbn0gZWxzZSB7XG4gIGRhdGEgPSBKU09OLnBhcnNlKHhoci5yZXNwb25zZVRleHQpO1xufVxuXG52YXIgZXZlbnRzID0gZGF0YS5ldmVudHM7XG5cbmZ1bmN0aW9uIGNyZWF0ZUVsZW1lbnRGcm9tSFRNTChodG1sU3RyaW5nKSB7XG4gIHZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgZGl2LmlubmVySFRNTCA9IGh0bWxTdHJpbmcudHJpbSgpO1xuICByZXR1cm4gZGl2LmZpcnN0Q2hpbGQ7XG59XG5cbmZ1bmN0aW9uIHBhcnNlVGVtcGxhdGUodGVtcGxhdGUsIHZhcmlhYmxlcykge1xuICB2YXIgcmVzdWx0ID0gdGVtcGxhdGUub3V0ZXJIVE1MO1xuICBPYmplY3Qua2V5cyh2YXJpYWJsZXMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgIGlmICh2YXJpYWJsZXNba2V5XSA9PT0gbnVsbCkge1xuICAgICAgdmFyaWFibGVzW2tleV0gPSAnJztcbiAgICB9XG4gICAgcmVzdWx0ID0gcmVzdWx0LnJlcGxhY2UoJ3t7ICcgKyBrZXkgKyAnIH19JywgdmFyaWFibGVzW2tleV0pO1xuICB9KTtcbiAgcmV0dXJuIGNyZWF0ZUVsZW1lbnRGcm9tSFRNTChyZXN1bHQpO1xufVxuXG5mb3IgKHZhciBpID0gMDsgaSA8IGV2ZW50cy5sZW5ndGg7IGkrKykge1xuXG4gIHZhciBtb2R1bGUgPSBtb2R1bGVUZW1wbGF0ZS5jbG9uZU5vZGUodHJ1ZSk7XG4gIG1vZHVsZSA9IHBhcnNlVGVtcGxhdGUobW9kdWxlVGVtcGxhdGUsIGV2ZW50c1tpXSk7XG5cbiAgaWYgKGV2ZW50c1tpXS5kZXNjcmlwdGlvbiA9PT0gJycpIHtcbiAgICBtb2R1bGUucXVlcnlTZWxlY3RvcignLm1vZHVsZV9fbWVzc2FnZScpLmNsYXNzTGlzdC5hZGQoJ21vZHVsZV9fbWVzc2FnZS0tZGlzYWJsZWQnKTtcbiAgfVxuXG4gIGlmICgnZGF0YScgaW4gZXZlbnRzW2ldKSB7XG5cbiAgICBpZiAoZXZlbnRzW2ldLmljb24gPT09ICdjYW0nKSB7XG4gICAgICB2YXIgcGljdHVyZSA9IG1vZHVsZVBpY3R1cmUuY2xvbmVOb2RlKHRydWUpO1xuICAgICAgbW9kdWxlLnF1ZXJ5U2VsZWN0b3IoJy5tb2R1bGVfX21lc3NhZ2UnKS5hcHBlbmRDaGlsZChwaWN0dXJlKTtcbiAgICB9XG5cbiAgfVxuXG4gIGdyaWQuYXBwZW5kQ2hpbGQobW9kdWxlKTtcbn1cblxudmFyIGltYWdlQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZHVsZV9fcGljdHVyZScpO1xudmFyIGltYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZHVsZV9faW1hZ2UnKTtcblxudmFyIGltYWdlV2luZG93ID0gaW1hZ2VDb250YWluZXIub2Zmc2V0V2lkdGg7XG52YXIgaW1hZ2VXaWR0aCA9IGltYWdlLm9mZnNldFdpZHRoO1xuXG52YXIgcG9pbnRlckFycmF5ID0gW107XG52YXIgZGlzdGFuY2VQcmV2ID0gMDtcbnZhciBjdXJyZW50U2NhbGUgPSAxO1xuXG5pbWFnZS5zdHlsZS5sZWZ0ID0gJzBweCc7XG5pbWFnZS5zdHlsZS50cmFuc2Zvcm0gPSBcInNjYWxlKFwiICsgY3VycmVudFNjYWxlICsgXCIpXCI7XG5cbnZhciBtb3ZlVG9TdGFydFBvc2l0aW9uID0gZnVuY3Rpb24oKSB7XG4gIGltYWdlV2luZG93ID0gaW1hZ2VDb250YWluZXIub2Zmc2V0V2lkdGg7XG4gIGltYWdlLnN0eWxlLmxlZnQgPSAnMHB4JztcblxuICBpbWFnZVdpbmRvdyA9IGltYWdlQ29udGFpbmVyLm9mZnNldFdpZHRoO1xuICBpbWFnZVdpZHRoID0gaW1hZ2Uub2Zmc2V0V2lkdGg7XG59O1xuXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgZnVuY3Rpb24oKSB7XG4gIG1vdmVUb1N0YXJ0UG9zaXRpb24oKTtcbn0pO1xuXG5pbWFnZUNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdwb2ludGVyZG93bicsIGZ1bmN0aW9uIChldmVudCkge1xuICBpbWFnZUNvbnRhaW5lci5zZXRQb2ludGVyQ2FwdHVyZShldmVudC5wb2ludGVySWQpO1xuXG4gIHBvaW50ZXJBcnJheS5wdXNoKHtcbiAgICBpZDogZXZlbnQucG9pbnRlcklkLFxuICAgIHByZXZQb3NpdGlvbjoge1xuICAgICAgeDogZXZlbnQueCxcbiAgICAgIHk6IGV2ZW50LnlcbiAgICB9LFxuICAgIGN1cnJlbnRQb3NpdGlvbjoge1xuICAgICAgeDogZXZlbnQueCxcbiAgICAgIHk6IGV2ZW50LnlcbiAgICB9XG4gIH0pO1xufSk7XG5cbmltYWdlQ29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ3BvaW50ZXJtb3ZlJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gIGlmIChwb2ludGVyQXJyYXkubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuXG4gIH1cblxuICB2YXIgaW5kZXggPSBudWxsO1xuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgcG9pbnRlckFycmF5Lmxlbmd0aDsgaSsrKSB7XG4gICAgaWYgKHBvaW50ZXJBcnJheVtpXS5pZCA9PT0gZXZlbnQucG9pbnRlcklkKSB7XG4gICAgICBpbmRleCA9IGk7XG4gICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICBwb2ludGVyQXJyYXlbaW5kZXhdLmN1cnJlbnRQb3NpdGlvbi54ID0gZXZlbnQueDtcbiAgcG9pbnRlckFycmF5W2luZGV4XS5jdXJyZW50UG9zaXRpb24ueSA9IGV2ZW50Lnk7XG5cbiAgaWYgKHBvaW50ZXJBcnJheS5sZW5ndGggPiAxKSB7XG5cbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdib2R5Jykuc3R5bGUuYmFja2dyb3VuZCA9ICdncmVlbic7XG5cbiAgICB2YXIgY3VycmVudFBvc2l0aW9uWDEgPSBwb2ludGVyQXJyYXlbMF0uY3VycmVudFBvc2l0aW9uLng7XG4gICAgdmFyIGN1cnJlbnRQb3NpdGlvblkxID0gcG9pbnRlckFycmF5WzBdLmN1cnJlbnRQb3NpdGlvbi55O1xuICAgIHZhciBjdXJyZW50UG9zaXRpb25YMiA9IHBvaW50ZXJBcnJheVsxXS5jdXJyZW50UG9zaXRpb24ueDtcbiAgICB2YXIgY3VycmVudFBvc2l0aW9uWTIgPSBwb2ludGVyQXJyYXlbMV0uY3VycmVudFBvc2l0aW9uLnk7XG5cbiAgICB2YXIgZGlzdGFuY2UgPSBNYXRoLnNxcnQoTWF0aC5wb3coKGN1cnJlbnRQb3NpdGlvblgyIC0gY3VycmVudFBvc2l0aW9uWDEpLCAyKSArIE1hdGgucG93KChjdXJyZW50UG9zaXRpb25ZMiAtIGN1cnJlbnRQb3NpdGlvblkxKSwgMikpO1xuXG4gICAgaWYgKGRpc3RhbmNlUHJldikge1xuXG4gICAgICB2YXIgc2NhbGUgPSAwLjAxO1xuXG4gICAgICBpZiAoZGlzdGFuY2UgPiBkaXN0YW5jZVByZXYpIHtcbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpLnN0eWxlLmJhY2tncm91bmQgPSAncmVkJztcbiAgICAgICAgY3VycmVudFNjYWxlICs9IHNjYWxlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpLnN0eWxlLmJhY2tncm91bmQgPSAnYmx1ZSc7XG4gICAgICAgIGN1cnJlbnRTY2FsZSAtPSBzY2FsZTtcblxuICAgICAgICBpZiAoY3VycmVudFNjYWxlIDw9IDEpIHtcbiAgICAgICAgICBjdXJyZW50U2NhbGUgPSAxO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGltYWdlLnN0eWxlLnRyYW5zZm9ybSA9IFwic2NhbGUoXCIgKyBjdXJyZW50U2NhbGUgKyBcIilcIjtcbiAgICB9XG5cbiAgICBkaXN0YW5jZVByZXYgPSBkaXN0YW5jZTtcblxuICB9IGVsc2Uge1xuXG4gICAgdmFyIHN0YXJ0WCA9IHBvaW50ZXJBcnJheVtpbmRleF0ucHJldlBvc2l0aW9uLng7XG4gICAgdmFyIHggPSBldmVudC54O1xuICAgIHZhciBkeCA9IHggLSBzdGFydFg7XG4gICAgdmFyIGxlZnQgPSBpbWFnZS5zdHlsZS5sZWZ0LnJlcGxhY2UoJ3B4JywgJycpICogMTtcblxuICAgIGR4ID4gMCA/IGxlZnQgKz0gTWF0aC5hYnMoZHgpIDogbGVmdCAtPSBNYXRoLmFicyhkeCk7XG5cbiAgICBpZiAobGVmdCA+IDApIHtcbiAgICAgIGxlZnQgPSAwO1xuICAgIH1cblxuICAgIGlmIChsZWZ0IDwgaW1hZ2VXaW5kb3cgLSBpbWFnZVdpZHRoKSB7XG4gICAgICBsZWZ0ID0gaW1hZ2VXaW5kb3cgLSBpbWFnZVdpZHRoO1xuICAgIH1cblxuICAgIGltYWdlLnN0eWxlLmxlZnQgPSBsZWZ0ICsgJ3B4JztcbiAgICBwb2ludGVyQXJyYXlbaW5kZXhdLnByZXZQb3NpdGlvbi54ID0geDtcbiAgfVxufSk7XG5cbmltYWdlQ29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ3BvaW50ZXJ1cCcsIGZ1bmN0aW9uIChldmVudCkge1xuICB2YXIgaW5kZXggPSBudWxsO1xuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgcG9pbnRlckFycmF5Lmxlbmd0aDsgaSsrKSB7XG4gICAgaWYgKHBvaW50ZXJBcnJheVtpXS5pZCA9PT0gZXZlbnQucG9pbnRlcklkKSB7XG4gICAgICBpbmRleCA9IGk7XG4gICAgfVxuICB9XG5cbiAgcG9pbnRlckFycmF5LnNwbGljZShwb2ludGVyQXJyYXlbaW5kZXhdLCAxKTtcbn0pO1xuXG5pbWFnZUNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdwb2ludGVyY2FuY2VsJywgbW92ZVRvU3RhcnRQb3NpdGlvbik7XG5cbiJdfQ==
