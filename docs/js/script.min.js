var buttonMenu=document.querySelector(".js-menu-button"),menu=document.querySelector(".header-menu");buttonMenu.addEventListener("click",function(){menu.classList.toggle("header-menu--opened")});var data,grid=document.querySelector(".grid"),template=document.querySelector("#moduleTemplate"),moduleTemplate=template.content.querySelector(".module"),modulePicture=template.content.querySelector(".module__picture"),moduleDetails=template.content.querySelector(".module__cam-details"),xhr=new XMLHttpRequest;xhr.open("GET","events.json",!1),xhr.send(),200!=xhr.status?alert(xhr.status+": "+xhr.statusText):data=JSON.parse(xhr.responseText);var events=data.events;function createElementFromHTML(e){var t=document.createElement("div");return t.innerHTML=e.trim(),t.firstChild}function parseTemplate(e,t){var r=e.outerHTML;return Object.keys(t).forEach(function(e){null===t[e]&&(t[e]=""),r=r.replace("{{ "+e+" }}",t[e])}),createElementFromHTML(r)}for(var i=0;i<events.length;i++){var module=moduleTemplate.cloneNode(!0);if(module=parseTemplate(moduleTemplate,events[i]),""===events[i].description&&module.querySelector(".module__message").classList.add("module__message--disabled"),"data"in events[i]&&"cam"===events[i].icon){var picture=modulePicture.cloneNode(!0),details=moduleDetails.cloneNode(!0);module.querySelector(".module__message").appendChild(picture),module.querySelector(".module__message").appendChild(details)}grid.appendChild(module)}var imageContainer=document.querySelector(".module__picture"),image=document.querySelector(".module__image"),imageIndicator=document.querySelector(".module__indicator"),imageScale=document.querySelector(".module__scale strong"),imageBrightness=document.querySelector(".module__light strong"),imageWindow=imageContainer.offsetWidth,imageWidth=image.offsetWidth,imageIndicatorWidth=imageIndicator.offsetWidth,pointerArray=[],distancePrev=0,currentScale=1,currentBrightness=100,prevAngleChange=0;image.style.left="0px",imageIndicator.style.left="0px",image.style.transform="scale("+currentScale+")",imageScale.innerHTML=100*currentScale+"%",imageBrightness.innerHTML=currentBrightness+"%";var moveToStartPosition=function(){imageWindow=imageContainer.offsetWidth,imageWidth=image.offsetWidth,imageIndicatorWidth=imageIndicator.offsetWidth,image.style.left="0px",imageIndicator.style.left="0px",image.style.transform="scale(1)",imageBrightness.innerHTML="100%",imageScale.innerHTML="100%"},getDistance=function(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},getAngle=function(e,t){return Math.atan2(e.y-t.y,e.x-t.x)},onMove=function(e){var t=pointerArray[e].prevPosition.x,r=event.x,n=r-t,i=1*image.style.left.replace("px",""),a=1*imageIndicator.style.left.replace("px",""),o=(imageWindow-imageIndicatorWidth)/(imageWidth-imageWindow);0<n?i+=Math.abs(n):i-=Math.abs(n),0<n?a-=Math.abs(n)*o:a+=Math.abs(n)*o,0<i&&(a=i=0),i<imageWindow-imageWidth&&(i=imageWindow-imageWidth,a=imageWindow-imageIndicatorWidth),image.style.left=i+"px",pointerArray[e].prevPosition.x=r,imageIndicator.style.left=a+"px"},onPinch=function(){var e=getDistance(pointerArray[0].currentPosition,pointerArray[1].currentPosition),t=getDistance(pointerArray[0].startPosition,pointerArray[1].startPosition);if(!(Math.abs(e-t)<30)){if(distancePrev){distancePrev<e?currentScale+=.03:(currentScale-=.03)<=1&&(currentScale=1),image.style.transform="scale("+currentScale+")",imageScale.innerHTML=Math.ceil(100*currentScale)+"%"}distancePrev=e}},onRotate=function(){var e=getAngle(pointerArray[0].startPosition,pointerArray[1].startPosition),t=getAngle(pointerArray[0].currentPosition,pointerArray[1].currentPosition),r=180*(t-e)/Math.PI;if(prevAngleChange){if(Math.abs(e-t)<.5)return;r<0&&(r+=360),prevAngleChange<r?currentBrightness+=1:currentBrightness-=1,100<currentBrightness&&(currentBrightness=100),currentBrightness<0&&(currentBrightness=0),image.style.filter="brightness("+currentBrightness+"%)",imageBrightness.innerHTML=Math.ceil(currentBrightness)+"%"}prevAngleChange=r};window.addEventListener("resize",function(){moveToStartPosition()}),imageContainer.addEventListener("pointerdown",function(e){imageContainer.setPointerCapture(e.pointerId),pointerArray.push({id:e.pointerId,startPosition:{x:e.x,y:e.y},prevPosition:{x:e.x,y:e.y},currentPosition:{x:e.x,y:e.y}})}),imageContainer.addEventListener("pointermove",function(e){if(0!==pointerArray.length){for(var t=null,r=0;r<pointerArray.length;r++)if(pointerArray[r].id===e.pointerId){t=r;break}pointerArray[t].currentPosition.x=e.x,pointerArray[t].currentPosition.y=e.y,1<pointerArray.length?(onPinch(),onRotate()):onMove(t)}}),imageContainer.addEventListener("pointerup",function(e){for(var t=null,r=0;r<pointerArray.length;r++)pointerArray[r].id===e.pointerId&&(t=r);pointerArray.splice(pointerArray[t],1)}),imageContainer.addEventListener("pointercancel",moveToStartPosition);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJidXR0b25NZW51IiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwibWVudSIsImFkZEV2ZW50TGlzdGVuZXIiLCJjbGFzc0xpc3QiLCJ0b2dnbGUiLCJkYXRhIiwiZ3JpZCIsInRlbXBsYXRlIiwibW9kdWxlVGVtcGxhdGUiLCJjb250ZW50IiwibW9kdWxlUGljdHVyZSIsIm1vZHVsZURldGFpbHMiLCJ4aHIiLCJYTUxIdHRwUmVxdWVzdCIsIm9wZW4iLCJzZW5kIiwic3RhdHVzIiwiYWxlcnQiLCJzdGF0dXNUZXh0IiwiSlNPTiIsInBhcnNlIiwicmVzcG9uc2VUZXh0IiwiZXZlbnRzIiwiY3JlYXRlRWxlbWVudEZyb21IVE1MIiwiaHRtbFN0cmluZyIsImRpdiIsImNyZWF0ZUVsZW1lbnQiLCJpbm5lckhUTUwiLCJ0cmltIiwiZmlyc3RDaGlsZCIsInBhcnNlVGVtcGxhdGUiLCJ2YXJpYWJsZXMiLCJyZXN1bHQiLCJvdXRlckhUTUwiLCJPYmplY3QiLCJrZXlzIiwiZm9yRWFjaCIsImtleSIsInJlcGxhY2UiLCJpIiwibGVuZ3RoIiwibW9kdWxlIiwiY2xvbmVOb2RlIiwiZGVzY3JpcHRpb24iLCJhZGQiLCJpY29uIiwicGljdHVyZSIsImRldGFpbHMiLCJhcHBlbmRDaGlsZCIsImltYWdlQ29udGFpbmVyIiwiaW1hZ2UiLCJpbWFnZUluZGljYXRvciIsImltYWdlU2NhbGUiLCJpbWFnZUJyaWdodG5lc3MiLCJpbWFnZVdpbmRvdyIsIm9mZnNldFdpZHRoIiwiaW1hZ2VXaWR0aCIsImltYWdlSW5kaWNhdG9yV2lkdGgiLCJwb2ludGVyQXJyYXkiLCJkaXN0YW5jZVByZXYiLCJjdXJyZW50U2NhbGUiLCJjdXJyZW50QnJpZ2h0bmVzcyIsInByZXZBbmdsZUNoYW5nZSIsInN0eWxlIiwibGVmdCIsInRyYW5zZm9ybSIsIm1vdmVUb1N0YXJ0UG9zaXRpb24iLCJnZXREaXN0YW5jZSIsInAxIiwicDIiLCJNYXRoIiwic3FydCIsInBvdyIsIngiLCJ5IiwiZ2V0QW5nbGUiLCJhdGFuMiIsIm9uTW92ZSIsImluZGV4Iiwic3RhcnRYIiwicHJldlBvc2l0aW9uIiwiZXZlbnQiLCJkeCIsImxlZnRJbmRpY2F0b3IiLCJkbGVmdCIsImFicyIsIm9uUGluY2giLCJkaXN0YW5jZSIsImN1cnJlbnRQb3NpdGlvbiIsImRpc3RhbmNlU3RhcnQiLCJzdGFydFBvc2l0aW9uIiwiY2VpbCIsIm9uUm90YXRlIiwic3RhcnRBbmdsZSIsImN1cnJlbnRBbmdsZSIsImFuZ2xlQ2hhbmdlIiwiUEkiLCJmaWx0ZXIiLCJ3aW5kb3ciLCJzZXRQb2ludGVyQ2FwdHVyZSIsInBvaW50ZXJJZCIsInB1c2giLCJpZCIsInNwbGljZSJdLCJtYXBwaW5ncyI6IkFBQUEsSUFBSUEsV0FBYUMsU0FBU0MsY0FBYyxtQkFDcENDLEtBQU9GLFNBQVNDLGNBQWMsZ0JBS2xDRixXQUFXSSxpQkFBaUIsUUFBUyxXQUNuQ0QsS0FBS0UsVUFBVUMsT0FBTyx5QkFHeEIsSUFRSUMsS0FSQUMsS0FBT1AsU0FBU0MsY0FBYyxTQUU5Qk8sU0FBV1IsU0FBU0MsY0FBYyxtQkFFbENRLGVBQWlCRCxTQUFTRSxRQUFRVCxjQUFjLFdBQ2hEVSxjQUFnQkgsU0FBU0UsUUFBUVQsY0FBYyxvQkFDL0NXLGNBQWdCSixTQUFTRSxRQUFRVCxjQUFjLHdCQUkvQ1ksSUFBTSxJQUFJQyxlQUNkRCxJQUFJRSxLQUFLLE1BQU8sZUFBZSxHQUMvQkYsSUFBSUcsT0FDYyxLQUFkSCxJQUFJSSxPQUNOQyxNQUFPTCxJQUFJSSxPQUFTLEtBQU9KLElBQUlNLFlBRS9CYixLQUFPYyxLQUFLQyxNQUFNUixJQUFJUyxjQUd4QixJQUFJQyxPQUFTakIsS0FBS2lCLE9BT2xCLFNBQVNDLHNCQUFzQkMsR0FDN0IsSUFBSUMsRUFBTTFCLFNBQVMyQixjQUFjLE9BRWpDLE9BREFELEVBQUlFLFVBQVlILEVBQVdJLE9BQ3BCSCxFQUFJSSxXQVNiLFNBQVNDLGNBQWN2QixFQUFVd0IsR0FDL0IsSUFBSUMs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QWlCLFNBQVUsV0FDaENnRSx3QkFNRmpCLGVBQWUvQyxpQkFBaUIsY0FBZSxTQUFVK0UsR0FDdkRoQyxlQUFla0Qsa0JBQWtCbEIsRUFBTW1CLFdBRXZDMUMsYUFBYTJDLEtBQUssQ0FDaEJDLEdBQUlyQixFQUFNbUIsVUFDVlYsY0FBZSxDQUNiakIsRUFBR1EsRUFBTVIsRUFDVEMsRUFBR08sRUFBTVAsR0FFWE0sYUFBYyxDQUNaUCxFQUFHUSxFQUFNUixFQUNUQyxFQUFHTyxFQUFNUCxHQUVYYyxnQkFBaUIsQ0FDZmYsRUFBR1EsRUFBTVIsRUFDVEMsRUFBR08sRUFBTVAsT0FRZnpCLGVBQWUvQyxpQkFBaUIsY0FBZSxTQUFVK0UsR0FDdkQsR0FBNEIsSUFBeEJ2QixhQUFhbEIsT0FBakIsQ0FLQSxJQURBLElBQUlzQyxFQUFRLEtBQ0h2QyxFQUFJLEVBQUdBLEVBQUltQixhQUFhbEIsT0FBUUQsSUFDdkMsR0FBSW1CLGFBQWFuQixHQUFHK0QsS0FBT3JCLEVBQU1tQixVQUFXLENBQzFDdEIsRUFBUXZDLEVBQ1IsTUFJSm1CLGFBQWFvQixHQUFPVSxnQkFBZ0JmLEVBQUlRLEVBQU1SLEVBQzlDZixhQUFhb0IsR0FBT1UsZ0JBQWdCZCxFQUFJTyxFQUFNUCxFQUVwQixFQUF0QmhCLGFBQWFsQixRQUVmOEMsVUFFQU0sWUFJQWYsT0FBT0MsTUFRWDdCLGVBQWUvQyxpQkFBaUIsWUFBYSxTQUFVK0UsR0FHckQsSUFGQSxJQUFJSCxFQUFRLEtBRUh2QyxFQUFJLEVBQUdBLEVBQUltQixhQUFhbEIsT0FBUUQsSUFDbkNtQixhQUFhbkIsR0FBRytELEtBQU9yQixFQUFNbUIsWUFDL0J0QixFQUFRdkMsR0FJWm1CLGFBQWE2QyxPQUFPN0MsYUFBYW9CLEdBQVEsS0FNM0M3QixlQUFlL0MsaUJBQWlCLGdCQUFpQmdFIiwiZmlsZSI6InNjcmlwdC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgYnV0dG9uTWVudSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5qcy1tZW51LWJ1dHRvbicpO1xudmFyIG1lbnUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaGVhZGVyLW1lbnUnKTtcblxuLyoqXG4gKiBFdmVudExpc3RlbmVyIG9uIGNsaWNrIG1lbnUgYnV0dG9uXG4gKi9cbmJ1dHRvbk1lbnUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gIG1lbnUuY2xhc3NMaXN0LnRvZ2dsZSgnaGVhZGVyLW1lbnUtLW9wZW5lZCcpO1xufSk7XG5cbnZhciBncmlkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmdyaWQnKTtcblxudmFyIHRlbXBsYXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI21vZHVsZVRlbXBsYXRlJyk7XG5cbnZhciBtb2R1bGVUZW1wbGF0ZSA9IHRlbXBsYXRlLmNvbnRlbnQucXVlcnlTZWxlY3RvcignLm1vZHVsZScpO1xudmFyIG1vZHVsZVBpY3R1cmUgPSB0ZW1wbGF0ZS5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2R1bGVfX3BpY3R1cmUnKTtcbnZhciBtb2R1bGVEZXRhaWxzID0gdGVtcGxhdGUuY29udGVudC5xdWVyeVNlbGVjdG9yKCcubW9kdWxlX19jYW0tZGV0YWlscycpO1xuXG52YXIgZGF0YTtcblxudmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xueGhyLm9wZW4oJ0dFVCcsICdldmVudHMuanNvbicsIGZhbHNlKTtcbnhoci5zZW5kKCk7XG5pZiAoeGhyLnN0YXR1cyAhPSAyMDApIHtcbiAgYWxlcnQoIHhoci5zdGF0dXMgKyAnOiAnICsgeGhyLnN0YXR1c1RleHQgKTtcbn0gZWxzZSB7XG4gIGRhdGEgPSBKU09OLnBhcnNlKHhoci5yZXNwb25zZVRleHQpO1xufVxuXG52YXIgZXZlbnRzID0gZGF0YS5ldmVudHM7XG5cbi8qKlxuICogQ3JlYXRlcyBlbGVtZW50IGZyb20gaHRtbFxuICogQHBhcmFtIGh0bWxTdHJpbmdcbiAqIEByZXR1cm5zIHtOb2RlfVxuICovXG5mdW5jdGlvbiBjcmVhdGVFbGVtZW50RnJvbUhUTUwoaHRtbFN0cmluZykge1xuICB2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gIGRpdi5pbm5lckhUTUwgPSBodG1sU3RyaW5nLnRyaW0oKTtcbiAgcmV0dXJuIGRpdi5maXJzdENoaWxkO1xufVxuXG4vKipcbiAqIFBhcnNlcyB0ZW1wbGF0ZSBhbmQgcmVwbGFjZXMgcGFyYW1ldGVyc1xuICogQHBhcmFtIHRlbXBsYXRlXG4gKiBAcGFyYW0gdmFyaWFibGVzXG4gKiBAcmV0dXJucyB7Kn1cbiAqL1xuZnVuY3Rpb24gcGFyc2VUZW1wbGF0ZSh0ZW1wbGF0ZSwgdmFyaWFibGVzKSB7XG4gIHZhciByZXN1bHQgPSB0ZW1wbGF0ZS5vdXRlckhUTUw7XG4gIE9iamVjdC5rZXlzKHZhcmlhYmxlcykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgaWYgKHZhcmlhYmxlc1trZXldID09PSBudWxsKSB7XG4gICAgICB2YXJpYWJsZXNba2V5XSA9ICcnO1xuICAgIH1cbiAgICByZXN1bHQgPSByZXN1bHQucmVwbGFjZSgne3sgJyArIGtleSArICcgfX0nLCB2YXJpYWJsZXNba2V5XSk7XG4gIH0pO1xuICByZXR1cm4gY3JlYXRlRWxlbWVudEZyb21IVE1MKHJlc3VsdCk7XG59XG5cbmZvciAodmFyIGkgPSAwOyBpIDwgZXZlbnRzLmxlbmd0aDsgaSsrKSB7XG5cbiAgdmFyIG1vZHVsZSA9IG1vZHVsZVRlbXBsYXRlLmNsb25lTm9kZSh0cnVlKTtcbiAgbW9kdWxlID0gcGFyc2VUZW1wbGF0ZShtb2R1bGVUZW1wbGF0ZSwgZXZlbnRzW2ldKTtcblxuICBpZiAoZXZlbnRzW2ldLmRlc2NyaXB0aW9uID09PSAnJykge1xuICAgIG1vZHVsZS5xdWVyeVNlbGVjdG9yKCcubW9kdWxlX19tZXNzYWdlJykuY2xhc3NMaXN0LmFkZCgnbW9kdWxlX19tZXNzYWdlLS1kaXNhYmxlZCcpO1xuICB9XG5cbiAgaWYgKCdkYXRhJyBpbiBldmVudHNbaV0pIHtcblxuICAgIGlmIChldmVudHNbaV0uaWNvbiA9PT0gJ2NhbScpIHtcbiAgICAgIHZhciBwaWN0dXJlID0gbW9kdWxlUGljdHVyZS5jbG9uZU5vZGUodHJ1ZSk7XG4gICAgICB2YXIgZGV0YWlscyA9IG1vZHVsZURldGFpbHMuY2xvbmVOb2RlKHRydWUpO1xuICAgICAgbW9kdWxlLnF1ZXJ5U2VsZWN0b3IoJy5tb2R1bGVfX21lc3NhZ2UnKS5hcHBlbmRDaGlsZChwaWN0dXJlKTtcbiAgICAgIG1vZHVsZS5xdWVyeVNlbGVjdG9yKCcubW9kdWxlX19tZXNzYWdlJykuYXBwZW5kQ2hpbGQoZGV0YWlscyk7XG4gICAgfVxuICB9XG5cbiAgZ3JpZC5hcHBlbmRDaGlsZChtb2R1bGUpO1xufVxuXG52YXIgaW1hZ2VDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kdWxlX19waWN0dXJlJyk7XG52YXIgaW1hZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kdWxlX19pbWFnZScpO1xudmFyIGltYWdlSW5kaWNhdG9yID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZHVsZV9faW5kaWNhdG9yJyk7XG52YXIgaW1hZ2VTY2FsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2R1bGVfX3NjYWxlIHN0cm9uZycpO1xudmFyIGltYWdlQnJpZ2h0bmVzcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2R1bGVfX2xpZ2h0IHN0cm9uZycpO1xuXG52YXIgaW1hZ2VXaW5kb3cgPSBpbWFnZUNvbnRhaW5lci5vZmZzZXRXaWR0aDtcbnZhciBpbWFnZVdpZHRoID0gaW1hZ2Uub2Zmc2V0V2lkdGg7XG52YXIgaW1hZ2VJbmRpY2F0b3JXaWR0aCA9IGltYWdlSW5kaWNhdG9yLm9mZnNldFdpZHRoO1xuXG52YXIgcG9pbnRlckFycmF5ID0gW107XG52YXIgZGlzdGFuY2VQcmV2ID0gMDtcbnZhciBjdXJyZW50U2NhbGUgPSAxO1xudmFyIGN1cnJlbnRCcmlnaHRuZXNzID0gMTAwO1xudmFyIHByZXZBbmdsZUNoYW5nZSA9IDA7XG5cbmltYWdlLnN0eWxlLmxlZnQgPSAnMHB4JztcbmltYWdlSW5kaWNhdG9yLnN0eWxlLmxlZnQgPSAnMHB4JztcblxuaW1hZ2Uuc3R5bGUudHJhbnNmb3JtID0gXCJzY2FsZShcIiArIGN1cnJlbnRTY2FsZSArIFwiKVwiO1xuXG5pbWFnZVNjYWxlLmlubmVySFRNTCA9IGN1cnJlbnRTY2FsZSAqIDEwMCArICclJztcbmltYWdlQnJpZ2h0bmVzcy5pbm5lckhUTUwgPSBjdXJyZW50QnJpZ2h0bmVzcyArICclJztcblxuLyoqXG4gKiBNb3ZlcyBzeXN0ZW0gdG8gc3RhcnQgcG9zaXRpb25cbiAqL1xudmFyIG1vdmVUb1N0YXJ0UG9zaXRpb24gPSBmdW5jdGlvbiAoKSB7XG4gIGltYWdlV2luZG93ID0gaW1hZ2VDb250YWluZXIub2Zmc2V0V2lkdGg7XG4gIGltYWdlV2lkdGggPSBpbWFnZS5vZmZzZXRXaWR0aDtcbiAgaW1hZ2VJbmRpY2F0b3JXaWR0aCA9IGltYWdlSW5kaWNhdG9yLm9mZnNldFdpZHRoO1xuXG4gIGltYWdlLnN0eWxlLmxlZnQgPSAnMHB4JztcbiAgaW1hZ2VJbmRpY2F0b3Iuc3R5bGUubGVmdCA9ICcwcHgnO1xuXG4gIGltYWdlLnN0eWxlLnRyYW5zZm9ybSA9IFwic2NhbGUoXCIgKyAxICsgXCIpXCI7XG5cbiAgaW1hZ2VCcmlnaHRuZXNzLmlubmVySFRNTCA9ICcxMDAlJztcbiAgaW1hZ2VTY2FsZS5pbm5lckhUTUwgPSAnMTAwJSc7XG59O1xuXG4vKipcbiAqIENhbGN1bGF0ZXMgZGlzdGFuY2VcbiAqIEBwYXJhbSBwMVxuICogQHBhcmFtIHAyXG4gKiBAcmV0dXJucyB7bnVtYmVyfVxuICovXG52YXIgZ2V0RGlzdGFuY2UgPSBmdW5jdGlvbiAocDEsIHAyKSB7XG4gIHJldHVybiBNYXRoLnNxcnQoTWF0aC5wb3coKHAyLnggLSBwMS54KSwgMikgKyBNYXRoLnBvdygocDIueSAtIHAxLnkpLCAyKSk7XG59O1xuXG4vKipcbiAqIENhbGN1bGF0ZXMgYW5nbGVcbiAqIEBwYXJhbSBwMVxuICogQHBhcmFtIHAyXG4gKiBAcmV0dXJucyB7bnVtYmVyfVxuICovXG52YXIgZ2V0QW5nbGUgPSBmdW5jdGlvbiAocDEsIHAyKSB7XG4gIHJldHVybiBNYXRoLmF0YW4yKHAxLnkgLSBwMi55LCBwMS54IC0gcDIueCk7XG59O1xuXG4vKipcbiAqIE1vdmVzIHBpY3R1cmVcbiAqIEBwYXJhbSBpbmRleFxuICovXG52YXIgb25Nb3ZlID0gZnVuY3Rpb24gKGluZGV4KSB7XG4gIHZhciBzdGFydFggPSBwb2ludGVyQXJyYXlbaW5kZXhdLnByZXZQb3NpdGlvbi54O1xuICB2YXIgeCA9IGV2ZW50Lng7XG4gIHZhciBkeCA9IHggLSBzdGFydFg7XG5cbiAgdmFyIGxlZnQgPSBpbWFnZS5zdHlsZS5sZWZ0LnJlcGxhY2UoJ3B4JywgJycpICogMTtcbiAgdmFyIGxlZnRJbmRpY2F0b3IgPSBpbWFnZUluZGljYXRvci5zdHlsZS5sZWZ0LnJlcGxhY2UoJ3B4JywgJycpICogMTtcblxuICB2YXIgZGxlZnQgPSAoaW1hZ2VXaW5kb3cgLSBpbWFnZUluZGljYXRvcldpZHRoKSAvIChpbWFnZVdpZHRoIC0gaW1hZ2VXaW5kb3cpO1xuXG4gIGR4ID4gMCA/IGxlZnQgKz0gTWF0aC5hYnMoZHgpIDogbGVmdCAtPSBNYXRoLmFicyhkeCk7XG4gIGR4ID4gMCA/IGxlZnRJbmRpY2F0b3IgLT0gTWF0aC5hYnMoZHgpICogZGxlZnQgOiBsZWZ0SW5kaWNhdG9yICs9IE1hdGguYWJzKGR4KSAqIGRsZWZ0O1xuXG4gIGlmIChsZWZ0ID4gMCkge1xuICAgIGxlZnQgPSAwO1xuICAgIGxlZnRJbmRpY2F0b3IgPSAwO1xuICB9XG5cbiAgaWYgKGxlZnQgPCBpbWFnZVdpbmRvdyAtIGltYWdlV2lkdGgpIHtcbiAgICBsZWZ0ID0gaW1hZ2VXaW5kb3cgLSBpbWFnZVdpZHRoO1xuICAgIGxlZnRJbmRpY2F0b3IgPSBpbWFnZVdpbmRvdyAtIGltYWdlSW5kaWNhdG9yV2lkdGg7XG4gIH1cblxuICBpbWFnZS5zdHlsZS5sZWZ0ID0gbGVmdCArICdweCc7XG4gIHBvaW50ZXJBcnJheVtpbmRleF0ucHJldlBvc2l0aW9uLnggPSB4O1xuXG4gIGltYWdlSW5kaWNhdG9yLnN0eWxlLmxlZnQgPSBsZWZ0SW5kaWNhdG9yICsgJ3B4Jztcbn07XG5cbi8qKlxuICogUGluY2hlcyB6b29tXG4gKi9cbnZhciBvblBpbmNoID0gZnVuY3Rpb24gKCkge1xuXG4gIHZhciBwaW5jaFRyZXNob2xkID0gMzA7XG5cbiAgdmFyIGRpc3RhbmNlID0gZ2V0RGlzdGFuY2UocG9pbnRlckFycmF5WzBdLmN1cnJlbnRQb3NpdGlvbiwgcG9pbnRlckFycmF5WzFdLmN1cnJlbnRQb3NpdGlvbik7XG4gIHZhciBkaXN0YW5jZVN0YXJ0ID0gZ2V0RGlzdGFuY2UocG9pbnRlckFycmF5WzBdLnN0YXJ0UG9zaXRpb24sIHBvaW50ZXJBcnJheVsxXS5zdGFydFBvc2l0aW9uKTtcblxuICBpZiAoTWF0aC5hYnMoZGlzdGFuY2UgLSBkaXN0YW5jZVN0YXJ0KSA8IHBpbmNoVHJlc2hvbGQpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBpZiAoZGlzdGFuY2VQcmV2KSB7XG4gICAgdmFyIHNjYWxlID0gMC4wMztcblxuICAgIGlmIChkaXN0YW5jZSA+IGRpc3RhbmNlUHJldikge1xuICAgICAgY3VycmVudFNjYWxlICs9IHNjYWxlO1xuICAgIH0gZWxzZSB7XG4gICAgICBjdXJyZW50U2NhbGUgLT0gc2NhbGU7XG4gICAgICBpZiAoY3VycmVudFNjYWxlIDw9IDEpIHtcbiAgICAgICAgY3VycmVudFNjYWxlID0gMTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpbWFnZS5zdHlsZS50cmFuc2Zvcm0gPSBcInNjYWxlKFwiICsgY3VycmVudFNjYWxlICsgXCIpXCI7XG4gICAgaW1hZ2VTY2FsZS5pbm5lckhUTUwgPSBNYXRoLmNlaWwoY3VycmVudFNjYWxlICogMTAwKSArICclJztcbiAgfVxuXG4gIGRpc3RhbmNlUHJldiA9IGRpc3RhbmNlO1xufTtcblxuLyoqXG4gKiBSb3RhdGVzIGJyaWdodG5lc3NcbiAqL1xudmFyIG9uUm90YXRlID0gZnVuY3Rpb24gKCkge1xuXG4gIHZhciByb3RhdGVUcmVzaG9sZCA9IDAuNTtcblxuICB2YXIgc3RhcnRBbmdsZSA9IGdldEFuZ2xlKHBvaW50ZXJBcnJheVswXS5zdGFydFBvc2l0aW9uLCBwb2ludGVyQXJyYXlbMV0uc3RhcnRQb3NpdGlvbik7XG4gIHZhciBjdXJyZW50QW5nbGUgPSBnZXRBbmdsZShwb2ludGVyQXJyYXlbMF0uY3VycmVudFBvc2l0aW9uLCBwb2ludGVyQXJyYXlbMV0uY3VycmVudFBvc2l0aW9uKTtcbiAgdmFyIGFuZ2xlQ2hhbmdlID0gKGN1cnJlbnRBbmdsZSAtIHN0YXJ0QW5nbGUpICogMTgwIC8gTWF0aC5QSTtcblxuICBpZiAocHJldkFuZ2xlQ2hhbmdlKSB7XG4gICAgaWYgKE1hdGguYWJzKHN0YXJ0QW5nbGUgLSBjdXJyZW50QW5nbGUpIDwgcm90YXRlVHJlc2hvbGQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoYW5nbGVDaGFuZ2UgPCAwKSB7XG4gICAgICBhbmdsZUNoYW5nZSArPSAzNjA7XG4gICAgfVxuXG4gICAgaWYgKHByZXZBbmdsZUNoYW5nZSA8IGFuZ2xlQ2hhbmdlKSB7XG4gICAgICBjdXJyZW50QnJpZ2h0bmVzcyArPSAxO1xuICAgIH0gZWxzZSB7XG4gICAgICBjdXJyZW50QnJpZ2h0bmVzcyAtPSAxO1xuICAgIH1cblxuICAgIGlmIChjdXJyZW50QnJpZ2h0bmVzcyA+IDEwMCkge1xuICAgICAgY3VycmVudEJyaWdodG5lc3MgPSAxMDA7XG4gICAgfVxuXG4gICAgaWYgKGN1cnJlbnRCcmlnaHRuZXNzIDwgMCkge1xuICAgICAgY3VycmVudEJyaWdodG5lc3MgPSAwO1xuICAgIH1cblxuICAgIGltYWdlLnN0eWxlLmZpbHRlciA9ICdicmlnaHRuZXNzKCcgKyBjdXJyZW50QnJpZ2h0bmVzcyArICclKSc7XG4gICAgaW1hZ2VCcmlnaHRuZXNzLmlubmVySFRNTCA9IE1hdGguY2VpbChjdXJyZW50QnJpZ2h0bmVzcykgKyAnJSc7XG5cbiAgfVxuXG4gIHByZXZBbmdsZUNoYW5nZSA9IGFuZ2xlQ2hhbmdlO1xuXG59O1xuXG4vKipcbiAqIEV2ZW50TGlzdGVuZXIgb24gd2luZG93IHJlc2l6ZVxuICovXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgZnVuY3Rpb24gKCkge1xuICBtb3ZlVG9TdGFydFBvc2l0aW9uKCk7XG59KTtcblxuLyoqXG4gKiBFdmVudExpc3RlbmVyIG9uIHBvaW50ZXJkb3duXG4gKi9cbmltYWdlQ29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ3BvaW50ZXJkb3duJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gIGltYWdlQ29udGFpbmVyLnNldFBvaW50ZXJDYXB0dXJlKGV2ZW50LnBvaW50ZXJJZCk7XG5cbiAgcG9pbnRlckFycmF5LnB1c2goe1xuICAgIGlkOiBldmVudC5wb2ludGVySWQsXG4gICAgc3RhcnRQb3NpdGlvbjoge1xuICAgICAgeDogZXZlbnQueCxcbiAgICAgIHk6IGV2ZW50LnlcbiAgICB9LFxuICAgIHByZXZQb3NpdGlvbjoge1xuICAgICAgeDogZXZlbnQueCxcbiAgICAgIHk6IGV2ZW50LnlcbiAgICB9LFxuICAgIGN1cnJlbnRQb3NpdGlvbjoge1xuICAgICAgeDogZXZlbnQueCxcbiAgICAgIHk6IGV2ZW50LnlcbiAgICB9XG4gIH0pO1xufSk7XG5cbi8qKlxuICogRXZlbnRMaXN0ZW5lciBvbiBwb2ludGVybW92ZVxuICovXG5pbWFnZUNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdwb2ludGVybW92ZScsIGZ1bmN0aW9uIChldmVudCkge1xuICBpZiAocG9pbnRlckFycmF5Lmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVyblxuICB9XG5cbiAgdmFyIGluZGV4ID0gbnVsbDtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBwb2ludGVyQXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICBpZiAocG9pbnRlckFycmF5W2ldLmlkID09PSBldmVudC5wb2ludGVySWQpIHtcbiAgICAgIGluZGV4ID0gaTtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIHBvaW50ZXJBcnJheVtpbmRleF0uY3VycmVudFBvc2l0aW9uLnggPSBldmVudC54O1xuICBwb2ludGVyQXJyYXlbaW5kZXhdLmN1cnJlbnRQb3NpdGlvbi55ID0gZXZlbnQueTtcblxuICBpZiAocG9pbnRlckFycmF5Lmxlbmd0aCA+IDEpIHtcblxuICAgIG9uUGluY2goKTtcblxuICAgIG9uUm90YXRlKCk7XG5cbiAgfSBlbHNlIHtcblxuICAgIG9uTW92ZShpbmRleCk7XG5cbiAgfVxufSk7XG5cbi8qKlxuICogRXZlbnRMaXN0ZW5lciBvbiBwb2ludGVydXBcbiAqL1xuaW1hZ2VDb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcigncG9pbnRlcnVwJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gIHZhciBpbmRleCA9IG51bGw7XG5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBwb2ludGVyQXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICBpZiAocG9pbnRlckFycmF5W2ldLmlkID09PSBldmVudC5wb2ludGVySWQpIHtcbiAgICAgIGluZGV4ID0gaTtcbiAgICB9XG4gIH1cblxuICBwb2ludGVyQXJyYXkuc3BsaWNlKHBvaW50ZXJBcnJheVtpbmRleF0sIDEpO1xufSk7XG5cbi8qKlxuICogRXZlbnRMaXN0ZW5lciBvbiBwb2ludGVyY2FuY2VsXG4gKi9cbmltYWdlQ29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ3BvaW50ZXJjYW5jZWwnLCBtb3ZlVG9TdGFydFBvc2l0aW9uKTtcblxuIl19
